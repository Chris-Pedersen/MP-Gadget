<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MP-Gadget: forcetree.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MP-Gadget
   &#160;<span id="projectnumber">5.0.0.dev0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">forcetree.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>gravitational tree and code for Ewald correction  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;mpi.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="event_8h_source.html">event.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="slotsmanager_8h_source.html">slotsmanager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="partmanager_8h_source.html">partmanager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="domain_8h_source.html">domain.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="openmpsort_8h_source.html">openmpsort.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="forcetree_8h_source.html">forcetree.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mymalloc_8h_source.html">mymalloc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="endrun_8h_source.html">endrun.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="system_8h_source.html">system.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for forcetree.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c__incl.svg" width="736" height="1160"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="forcetree_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structNodeCache.html">NodeCache</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae9d22ac96be9a18932a00837b0a78f30"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>&#160;&#160;&#160;100</td></tr>
<tr class="separator:ae9d22ac96be9a18932a00837b0a78f30"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a69350a797a01322b05ec26913d2fa62d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a69350a797a01322b05ec26913d2fa62d">force_tree_build</a> (int npart)</td></tr>
<tr class="separator:a69350a797a01322b05ec26913d2fa62d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac1fca475cd9acc615f8e86d04198a2f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#aac1fca475cd9acc615f8e86d04198a2f">force_tree_build_single</a> (const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> tb, const int npart)</td></tr>
<tr class="separator:aac1fca475cd9acc615f8e86d04198a2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab571f41f30d0859373efe8f65b6523b2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#ab571f41f30d0859373efe8f65b6523b2">force_tree_create_nodes</a> (const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> tb, const int npart)</td></tr>
<tr class="separator:ab571f41f30d0859373efe8f65b6523b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c3f496b74e5a0099d41f36e05c2a787"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a9c3f496b74e5a0099d41f36e05c2a787">force_treeallocate</a> (int maxnodes, int maxpart, int first_node_offset)</td></tr>
<tr class="separator:a9c3f496b74e5a0099d41f36e05c2a787"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a079d4156d4368c439545f14fcf81878f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a079d4156d4368c439545f14fcf81878f">force_update_node_recursive</a> (int no, int sib, int tail, const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> tb)</td></tr>
<tr class="separator:a079d4156d4368c439545f14fcf81878f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b2e6ceda1e6b5ca4469148b13bff5dc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a4b2e6ceda1e6b5ca4469148b13bff5dc">force_treeupdate_pseudos</a> (int no, const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> tb)</td></tr>
<tr class="separator:a4b2e6ceda1e6b5ca4469148b13bff5dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8ee13a12eb949d8554c8d413b684a80"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#ad8ee13a12eb949d8554c8d413b684a80">force_create_node_for_topnode</a> (int no, int topnode, int bits, int x, int y, int z, int *nextfree, const int lastnode)</td></tr>
<tr class="separator:ad8ee13a12eb949d8554c8d413b684a80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaabf16b5e99c9ac6bc6bbe039756bddb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#aaabf16b5e99c9ac6bc6bbe039756bddb">force_exchange_pseudodata</a> (void)</td></tr>
<tr class="separator:aaabf16b5e99c9ac6bc6bbe039756bddb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dd5b4b96039c79e703efd5106ca012a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a5dd5b4b96039c79e703efd5106ca012a">force_insert_pseudo_particles</a> (const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> tb)</td></tr>
<tr class="separator:a5dd5b4b96039c79e703efd5106ca012a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c833489d009e4b5e850dc5997214775"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a> (<a class="el" href="structEIBase.html">EIBase</a> *event, void *userdata)</td></tr>
<tr class="separator:a6c833489d009e4b5e850dc5997214775"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1174e5cc4c75944aa98706941a70db9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#aa1174e5cc4c75944aa98706941a70db9">force_tree_allocated</a> ()</td></tr>
<tr class="separator:aa1174e5cc4c75944aa98706941a70db9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45a1a710bd7d997dbe7cf22a7600b731"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a45a1a710bd7d997dbe7cf22a7600b731">force_tree_rebuild</a> ()</td></tr>
<tr class="separator:a45a1a710bd7d997dbe7cf22a7600b731"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95095093b87159c1b23a2cb267d9940a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a> (const struct <a class="el" href="structNODE.html">NODE</a> *node, const int p_i)</td></tr>
<tr class="separator:a95095093b87159c1b23a2cb267d9940a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3ee27767a982ea77a18f5f4983e4344"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#ab3ee27767a982ea77a18f5f4983e4344">inside_node</a> (const struct <a class="el" href="structNODE.html">NODE</a> *node, const int p_i)</td></tr>
<tr class="separator:ab3ee27767a982ea77a18f5f4983e4344"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a068d7c90773680cb8c9b0684d584420d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a068d7c90773680cb8c9b0684d584420d">init_internal_node</a> (struct <a class="el" href="structNODE.html">NODE</a> *nfreep, struct <a class="el" href="structNODE.html">NODE</a> *parent, int subnode)</td></tr>
<tr class="separator:a068d7c90773680cb8c9b0684d584420d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6710cf447fc53308c513b002cf446ebf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a6710cf447fc53308c513b002cf446ebf">get_freenode</a> (int *nnext, struct <a class="el" href="structNodeCache.html">NodeCache</a> *nc)</td></tr>
<tr class="separator:a6710cf447fc53308c513b002cf446ebf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7206eeadd2231b432e8c0932fd23b1e5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a7206eeadd2231b432e8c0932fd23b1e5">modify_internal_node</a> (int parent, int subnode, int p_child, int p_toplace, const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> tb, int *nnext, struct <a class="el" href="structNodeCache.html">NodeCache</a> *nc, double minlen, int *closepairs)</td></tr>
<tr class="separator:a7206eeadd2231b432e8c0932fd23b1e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96d9883368c2630c024e1196e849f07c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a> (int no, const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> tb)</td></tr>
<tr class="separator:a96d9883368c2630c024e1196e849f07c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8571da12c389bfcf10555865a0e3882d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a8571da12c389bfcf10555865a0e3882d">force_set_next_node</a> (int no, int next, const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> tb)</td></tr>
<tr class="separator:a8571da12c389bfcf10555865a0e3882d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a6cf9ad0fab6ccef833c29596fb92fd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a7a6cf9ad0fab6ccef833c29596fb92fd">force_get_prev_node</a> (int no, const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> tb)</td></tr>
<tr class="separator:a7a6cf9ad0fab6ccef833c29596fb92fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a756a7b1f862dd81ef83e1f6c00f8ebb2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a756a7b1f862dd81ef83e1f6c00f8ebb2">force_adjust_node_softening</a> (struct <a class="el" href="structNODE.html">NODE</a> *pnode, double MaxSoftening, int mixed)</td></tr>
<tr class="separator:a756a7b1f862dd81ef83e1f6c00f8ebb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a569cd386bf7d67968fad6344898cb70c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a569cd386bf7d67968fad6344898cb70c">add_particle_moment_to_node</a> (struct <a class="el" href="structNODE.html">NODE</a> *pnode, int i)</td></tr>
<tr class="separator:a569cd386bf7d67968fad6344898cb70c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3aecab620a37299d10b8013a4db5611"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#ab3aecab620a37299d10b8013a4db5611">force_update_hmax</a> (int *activeset, int size)</td></tr>
<tr class="separator:ab3aecab620a37299d10b8013a4db5611"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ae933e7b7e909142281bae26f95cd00"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a2ae933e7b7e909142281bae26f95cd00">force_tree_free</a> (void)</td></tr>
<tr class="separator:a2ae933e7b7e909142281bae26f95cd00"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0cb940c6ac9331805bcc91b437c78e9a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structNODE.html">NODE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a></td></tr>
<tr class="separator:a0cb940c6ac9331805bcc91b437c78e9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac46f89ba3715dfa877c2e1b8822da657"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structNODE.html">NODE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a></td></tr>
<tr class="separator:ac46f89ba3715dfa877c2e1b8822da657"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca70a1751175167a36c1c6775a338bee"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a></td></tr>
<tr class="separator:aca70a1751175167a36c1c6775a338bee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a864c54aa65cc3be72a6ee67e77d4324a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a864c54aa65cc3be72a6ee67e77d4324a">RootNode</a></td></tr>
<tr class="separator:a864c54aa65cc3be72a6ee67e77d4324a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad14ab43f541f9c33cb9222ea018c1365"><td class="memItemLeft" align="right" valign="top">int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a></td></tr>
<tr class="separator:ad14ab43f541f9c33cb9222ea018c1365"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1adfde6b271afd077130a64e6b85766"><td class="memItemLeft" align="right" valign="top">int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a></td></tr>
<tr class="separator:ae1adfde6b271afd077130a64e6b85766"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74c0df66a077bd271e68e460f36d2169"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="forcetree_8c.html#a74c0df66a077bd271e68e460f36d2169">tree_allocated_flag</a> = 0</td></tr>
<tr class="separator:a74c0df66a077bd271e68e460f36d2169"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>gravitational tree and code for Ewald correction </p>
<p>This file contains the computation of the gravitational force by means of a tree. The type of tree implemented is a geometrical oct-tree, starting from a cube encompassing all particles. This cube is automatically found in the domain decomposition, which also splits up the global "top-level" tree along node boundaries, moving the particles of different parts of the tree to separate processors. Tree nodes can be dynamically updated in drift/kick operations to avoid having to reconstruct the tree every timestep. </p>

<p class="definition">Definition in file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae9d22ac96be9a18932a00837b0a78f30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9d22ac96be9a18932a00837b0a78f30">&#9670;&nbsp;</a></span>NODECACHE_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NODECACHE_SIZE&#160;&#160;&#160;100</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00221">221</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00231">get_freenode()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a569cd386bf7d67968fad6344898cb70c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a569cd386bf7d67968fad6344898cb70c">&#9670;&nbsp;</a></span>add_particle_moment_to_node()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void add_particle_moment_to_node </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structNODE.html">NODE</a> *&#160;</td>
          <td class="paramname"><em>pnode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00667">667</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="allvars_8c_source.html#l00047">All</a>, <a class="el" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a>, <a class="el" href="allvars_8h_source.html#l00258">global_data_all_processes::FastParticleType</a>, <a class="el" href="forcetree_8c_source.html#l00649">force_adjust_node_softening()</a>, <a class="el" href="partmanager_8h_source.html#l00106">FORCE_SOFTENING()</a>, <a class="el" href="allvars_8h_source.html#l00247">global_data_all_processes::HybridNeutrinosOn</a>, <a class="el" href="allvars_8h_source.html#l00250">global_data_all_processes::HybridNuPartTime</a>, <a class="el" href="partmanager_8h_source.html#l00099">P</a>, <a class="el" href="allvars_8h_source.html#l00267">global_data_all_processes::Time</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00707">force_update_node_recursive()</a>.</p>
<div class="fragment"><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;{</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordtype">int</span> k;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">/*Hybrid particle neutrinos do not gravitate at early times.</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">     * So do not add their masses to the node*/</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa5b73f85f7a8e48cf1a5be1478103fac">HybridNeutrinosOn</a> &amp;&amp; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> &lt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aea479260eefe91eebb80615ec696da5c">HybridNuPartTime</a> &amp;&amp; <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type == <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad169dc91dff8022cceaa83ff0cf9609b">FastParticleType</a>)</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    pnode-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass += (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">for</span>(k=0; k&lt;3; k++)</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        pnode-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[k] += (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Mass * <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Pos[k]);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Type == 0)</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Hsml &gt; pnode-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax)</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            pnode-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Hsml;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    }</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <a class="code" href="forcetree_8c.html#a756a7b1f862dd81ef83e1f6c00f8ebb2">force_adjust_node_softening</a>(pnode, <a class="code" href="partmanager_8h.html#a75af6ed4098fb6fbcc96a532b6e1bd11">FORCE_SOFTENING</a>(i), 0);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;}</div><div class="ttc" id="partmanager_8h_html_a75af6ed4098fb6fbcc96a532b6e1bd11"><div class="ttname"><a href="partmanager_8h.html#a75af6ed4098fb6fbcc96a532b6e1bd11">FORCE_SOFTENING</a></div><div class="ttdeci">static double FORCE_SOFTENING(int i)</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00106">partmanager.h:106</a></div></div>
<div class="ttc" id="partmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00099">partmanager.h:99</a></div></div>
<div class="ttc" id="structglobal__data__all__processes_html_aa5b73f85f7a8e48cf1a5be1478103fac"><div class="ttname"><a href="structglobal__data__all__processes.html#aa5b73f85f7a8e48cf1a5be1478103fac">global_data_all_processes::HybridNeutrinosOn</a></div><div class="ttdeci">int HybridNeutrinosOn</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8h_source.html#l00247">allvars.h:247</a></div></div>
<div class="ttc" id="structNODE_html_a7f339ed4a80e4bc82506fdab65a7d655"><div class="ttname"><a href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a></div><div class="ttdeci">struct NODE::@11::@12 d</div></div>
<div class="ttc" id="structglobal__data__all__processes_html_ad169dc91dff8022cceaa83ff0cf9609b"><div class="ttname"><a href="structglobal__data__all__processes.html#ad169dc91dff8022cceaa83ff0cf9609b">global_data_all_processes::FastParticleType</a></div><div class="ttdeci">int FastParticleType</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8h_source.html#l00258">allvars.h:258</a></div></div>
<div class="ttc" id="structglobal__data__all__processes_html_a25b9da73fdcbdc45fbe4a6ad45479f09"><div class="ttname"><a href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">global_data_all_processes::Time</a></div><div class="ttdeci">double Time</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8h_source.html#l00267">allvars.h:267</a></div></div>
<div class="ttc" id="forcetree_8c_html_a756a7b1f862dd81ef83e1f6c00f8ebb2"><div class="ttname"><a href="forcetree_8c.html#a756a7b1f862dd81ef83e1f6c00f8ebb2">force_adjust_node_softening</a></div><div class="ttdeci">static void force_adjust_node_softening(struct NODE *pnode, double MaxSoftening, int mixed)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00649">forcetree.c:649</a></div></div>
<div class="ttc" id="structglobal__data__all__processes_html_aea479260eefe91eebb80615ec696da5c"><div class="ttname"><a href="structglobal__data__all__processes.html#aea479260eefe91eebb80615ec696da5c">global_data_all_processes::HybridNuPartTime</a></div><div class="ttdeci">double HybridNuPartTime</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8h_source.html#l00250">allvars.h:250</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="allvars_8c_html_ad49123ae0461ffe61629a0d4cf2ba91f"><div class="ttname"><a href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a></div><div class="ttdeci">struct global_data_all_processes All</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8c_source.html#l00047">allvars.c:47</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a569cd386bf7d67968fad6344898cb70c_cgraph.svg" width="394" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a569cd386bf7d67968fad6344898cb70c_icgraph.svg" width="1868" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a756a7b1f862dd81ef83e1f6c00f8ebb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a756a7b1f862dd81ef83e1f6c00f8ebb2">&#9670;&nbsp;</a></span>force_adjust_node_softening()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void force_adjust_node_softening </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structNODE.html">NODE</a> *&#160;</td>
          <td class="paramname"><em>pnode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>MaxSoftening</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mixed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00649">649</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a>, <a class="el" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a>, <a class="el" href="forcetree_8h_source.html#l00021">NODE::MixedSofteningsInNode</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00667">add_particle_moment_to_node()</a>, <a class="el" href="forcetree_8c_source.html#l00902">force_treeupdate_pseudos()</a>, and <a class="el" href="forcetree_8c_source.html#l00707">force_update_node_recursive()</a>.</p>
<div class="fragment"><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;{</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">if</span>(pnode-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.MaxSoftening &gt; 0) {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="comment">/* already set? mark MixedSoftenings */</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="keywordflow">if</span>(MaxSoftening != pnode-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.MaxSoftening) {</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            pnode-&gt;<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">MixedSofteningsInNode</a> = 1;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">if</span>(MaxSoftening &gt; pnode-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.MaxSoftening) {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        pnode-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.MaxSoftening = MaxSoftening;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">if</span>(mixed) {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        pnode-&gt;<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">MixedSofteningsInNode</a> = 1;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;}</div><div class="ttc" id="structNODE_html_a721d8801f7caf356aaab78a822a56640"><div class="ttname"><a href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a></div><div class="ttdeci">struct NODE::@10 f</div></div>
<div class="ttc" id="structNODE_html_a7f339ed4a80e4bc82506fdab65a7d655"><div class="ttname"><a href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a></div><div class="ttdeci">struct NODE::@11::@12 d</div></div>
<div class="ttc" id="structNODE_html_a98a1b123b3faa9414fc9a82a5556951c"><div class="ttname"><a href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">NODE::MixedSofteningsInNode</a></div><div class="ttdeci">unsigned int MixedSofteningsInNode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00021">forcetree.h:21</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a756a7b1f862dd81ef83e1f6c00f8ebb2_icgraph.svg" width="2104" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad8ee13a12eb949d8554c8d413b684a80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8ee13a12eb949d8554c8d413b684a80">&#9670;&nbsp;</a></span>force_create_node_for_topnode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void force_create_node_for_topnode </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>topnode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nextfree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>lastnode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This function recursively creates a set of empty tree nodes which corresponds to the top-level tree for the domain grid. This is done to ensure that this top-level tree is always "complete" so that we can easily associate the pseudo-particles of other CPUs with tree-nodes at a given level in the tree, even when the particle population is so sparse that some of these nodes are actually empty. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00518">518</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00014">NODE::center</a>, <a class="el" href="domain_8h_source.html#l00012">topnode_data::Daughter</a>, <a class="el" href="endrun_8c_source.html#l00210">endrun()</a>, <a class="el" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a>, <a class="el" href="forcetree_8h_source.html#l00016">NODE::father</a>, <a class="el" href="forcetree_8h_source.html#l00018">NODE::InternalTopLevel</a>, <a class="el" href="domain_8h_source.html#l00014">topnode_data::Leaf</a>, <a class="el" href="forcetree_8h_source.html#l00013">NODE::len</a>, <a class="el" href="peano_8c_source.html#l00119">peano_hilbert_key()</a>, <a class="el" href="forcetree_8h_source.html#l00025">NODE::suns</a>, <a class="el" href="domain_8c_source.html#l00051">TopLeaves</a>, <a class="el" href="forcetree_8h_source.html#l00019">NODE::TopLevel</a>, <a class="el" href="domain_8c_source.html#l00050">TopNodes</a>, <a class="el" href="domain_8h_source.html#l00021">topleaf_data::treenode</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00333">force_tree_create_nodes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;{</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordtype">int</span> i, j, k, n, sub, count;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> lenhalf;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="domain_8c.html#a855acc131f2f1193f48d60fe63037e8c">TopNodes</a>[topnode].Daughter &gt;= 0)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    {</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; 2; i++)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="keywordflow">for</span>(j = 0; j &lt; 2; j++)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                <span class="keywordflow">for</span>(k = 0; k &lt; 2; k++)</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                    sub = 7 &amp; <a class="code" href="peano_8c.html#a2b98881a670e236ef744e3283ebe71a4">peano_hilbert_key</a>((x &lt;&lt; 1) + i, (y &lt;&lt; 1) + j, (z &lt;&lt; 1) + k, bits);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                    count = i + 2 * j + 4 * k;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[count] = *nextfree;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                    <span class="comment">/*We are an internal top level node as we now have a child top level.*/</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a> = 1;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                    lenhalf = 0.25 * <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[*nextfree].<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a> = 0.5 * <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[*nextfree].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[0] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[0] + (2 * i - 1) * lenhalf;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[*nextfree].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[1] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[1] + (2 * j - 1) * lenhalf;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[*nextfree].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[2] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[2] + (2 * k - 1) * lenhalf;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[*nextfree].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = no;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                    <span class="comment">/*All nodes here are top level nodes*/</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[*nextfree].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a> = 1;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[*nextfree].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a> = 0;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                    <span class="keywordflow">for</span>(n = 0; n &lt; 8; n++)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                        <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[*nextfree].u.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[n] = -1;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="domain_8c.html#a855acc131f2f1193f48d60fe63037e8c">TopNodes</a>[<a class="code" href="domain_8c.html#a855acc131f2f1193f48d60fe63037e8c">TopNodes</a>[topnode].<a class="code" href="structtopnode__data.html#ad2e76e39d74f3c299b38fa680ecdb794">Daughter</a> + sub].<a class="code" href="structtopnode__data.html#ad2e76e39d74f3c299b38fa680ecdb794">Daughter</a> == -1)</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                        <a class="code" href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a>[<a class="code" href="domain_8c.html#a855acc131f2f1193f48d60fe63037e8c">TopNodes</a>[<a class="code" href="domain_8c.html#a855acc131f2f1193f48d60fe63037e8c">TopNodes</a>[topnode].<a class="code" href="structtopnode__data.html#ad2e76e39d74f3c299b38fa680ecdb794">Daughter</a> + sub].<a class="code" href="structtopnode__data.html#aa5c48f2ae0bd1e2ed8ca069e4eeb29cd">Leaf</a>].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a> = *nextfree;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                    (*nextfree)++;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                    <span class="keywordflow">if</span>(*nextfree &gt;= lastnode)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(11, <span class="stringliteral">&quot;Not enough force nodes to topnode grid: need %d\n&quot;</span>,lastnode);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                    <a class="code" href="forcetree_8c.html#ad8ee13a12eb949d8554c8d413b684a80">force_create_node_for_topnode</a>(*nextfree - 1, <a class="code" href="domain_8c.html#a855acc131f2f1193f48d60fe63037e8c">TopNodes</a>[topnode].Daughter + sub,</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                            bits + 1, 2 * x + i, 2 * y + j, 2 * z + k, nextfree, lastnode);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                }</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div><div class="ttc" id="structtopnode__data_html_ad2e76e39d74f3c299b38fa680ecdb794"><div class="ttname"><a href="structtopnode__data.html#ad2e76e39d74f3c299b38fa680ecdb794">topnode_data::Daughter</a></div><div class="ttdeci">int Daughter</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00012">domain.h:12</a></div></div>
<div class="ttc" id="structNODE_html_a721d8801f7caf356aaab78a822a56640"><div class="ttname"><a href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a></div><div class="ttdeci">struct NODE::@10 f</div></div>
<div class="ttc" id="endrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00210">endrun.c:210</a></div></div>
<div class="ttc" id="structNODE_html_aa3b4bfc6b6c8c99d88860a5262679487"><div class="ttname"><a href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">NODE::TopLevel</a></div><div class="ttdeci">unsigned int TopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00019">forcetree.h:19</a></div></div>
<div class="ttc" id="domain_8c_html_a855acc131f2f1193f48d60fe63037e8c"><div class="ttname"><a href="domain_8c.html#a855acc131f2f1193f48d60fe63037e8c">TopNodes</a></div><div class="ttdeci">struct topnode_data * TopNodes</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00050">domain.c:50</a></div></div>
<div class="ttc" id="structNODE_html_ac63501e2f4f5076dfe3534268e89bc39"><div class="ttname"><a href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">NODE::InternalTopLevel</a></div><div class="ttdeci">unsigned int InternalTopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00018">forcetree.h:18</a></div></div>
<div class="ttc" id="domain_8c_html_aba985e8ae49746e598c581da7631076e"><div class="ttname"><a href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a></div><div class="ttdeci">struct topleaf_data * TopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00051">domain.c:51</a></div></div>
<div class="ttc" id="peano_8c_html_a2b98881a670e236ef744e3283ebe71a4"><div class="ttname"><a href="peano_8c.html#a2b98881a670e236ef744e3283ebe71a4">peano_hilbert_key</a></div><div class="ttdeci">peano_t peano_hilbert_key(int x, int y, int z, int bits)</div><div class="ttdef"><b>Definition:</b> <a href="peano_8c_source.html#l00119">peano.c:119</a></div></div>
<div class="ttc" id="structNODE_html_ae6d6383dc0bc3e1660bbe700b77a85ab"><div class="ttname"><a href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">NODE::len</a></div><div class="ttdeci">MyFloat len</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00013">forcetree.h:13</a></div></div>
<div class="ttc" id="structNODE_html_a9a1b7edbe811165e40220f63a38f2d16"><div class="ttname"><a href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">NODE::father</a></div><div class="ttdeci">int father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00016">forcetree.h:16</a></div></div>
<div class="ttc" id="forcetree_8c_html_ad8ee13a12eb949d8554c8d413b684a80"><div class="ttname"><a href="forcetree_8c.html#ad8ee13a12eb949d8554c8d413b684a80">force_create_node_for_topnode</a></div><div class="ttdeci">static void force_create_node_for_topnode(int no, int topnode, int bits, int x, int y, int z, int *nextfree, const int lastnode)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00518">forcetree.c:518</a></div></div>
<div class="ttc" id="structNODE_html_a3460a1b4f9607fe15e6adc40a737d947"><div class="ttname"><a href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">NODE::center</a></div><div class="ttdeci">MyFloat center[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00014">forcetree.h:14</a></div></div>
<div class="ttc" id="forcetree_8c_html_ac46f89ba3715dfa877c2e1b8822da657"><div class="ttname"><a href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00038">forcetree.c:38</a></div></div>
<div class="ttc" id="types_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00022">types.h:22</a></div></div>
<div class="ttc" id="structNODE_html_a2a31ed85a69cd67dce1861bd327ac6e9"><div class="ttname"><a href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">NODE::suns</a></div><div class="ttdeci">int suns[8]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00025">forcetree.h:25</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="structtopleaf__data_html_ab948aab0a7ca32817caaaec832643645"><div class="ttname"><a href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">topleaf_data::treenode</a></div><div class="ttdeci">int treenode</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00021">domain.h:21</a></div></div>
<div class="ttc" id="structtopnode__data_html_aa5c48f2ae0bd1e2ed8ca069e4eeb29cd"><div class="ttname"><a href="structtopnode__data.html#aa5c48f2ae0bd1e2ed8ca069e4eeb29cd">topnode_data::Leaf</a></div><div class="ttdeci">int Leaf</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00014">domain.h:14</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_ad8ee13a12eb949d8554c8d413b684a80_cgraph.svg" width="632" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_ad8ee13a12eb949d8554c8d413b684a80_icgraph.svg" width="1846" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aaabf16b5e99c9ac6bc6bbe039756bddb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaabf16b5e99c9ac6bc6bbe039756bddb">&#9670;&nbsp;</a></span>force_exchange_pseudodata()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void force_exchange_pseudodata </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This function communicates the values of the multipole moments of the top-level tree-nodes of the domain grid. This data can then be used to update the pseudo-particles on each CPU accordingly. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00815">815</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a>, <a class="el" href="forcetree_8h_source.html#l00020">NODE::DependsOnLocalMass</a>, <a class="el" href="domain_8h_source.html#l00027">task_data::EndLeaf</a>, <a class="el" href="endrun_8c_source.html#l00210">endrun()</a>, <a class="el" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a>, <a class="el" href="forcetree_8h_source.html#l00016">NODE::father</a>, <a class="el" href="forcetree_8h_source.html#l00021">NODE::MixedSofteningsInNode</a>, <a class="el" href="mymalloc_8h_source.html#l00016">myfree</a>, <a class="el" href="mymalloc_8h_source.html#l00012">mymalloc</a>, <a class="el" href="allvars_8c_source.html#l00025">NTask</a>, <a class="el" href="domain_8c_source.html#l00055">NTopLeaves</a>, <a class="el" href="auxiliary__functions_8c_source.html#l00014">s</a>, <a class="el" href="domain_8h_source.html#l00026">task_data::StartLeaf</a>, <a class="el" href="domain_8c_source.html#l00078">Tasks</a>, <a class="el" href="allvars_8c_source.html#l00024">ThisTask</a>, <a class="el" href="domain_8c_source.html#l00051">TopLeaves</a>, <a class="el" href="domain_8h_source.html#l00021">topleaf_data::treenode</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00121">force_tree_build()</a>.</p>
<div class="fragment"><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;{</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordtype">int</span> i, no, ta, recvTask;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordtype">int</span> *recvcounts, *recvoffset;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keyword">struct </span>topleaf_momentsdata</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    {</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="auxiliary__functions_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a>[3];</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> mass;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> hmax;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keyword">struct </span>{</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MixedSofteningsInNode :1;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        };</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> MaxSoftening;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    }</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    *TopLeafMoments;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    TopLeafMoments = (<span class="keyword">struct </span>topleaf_momentsdata *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;TopLeafMoments&quot;</span>, <a class="code" href="domain_8c.html#a1c853817a113e66c3d16ad1216733919">NTopLeaves</a> * <span class="keyword">sizeof</span>(TopLeafMoments[0]));</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    memset(&amp;TopLeafMoments[0], 0, <span class="keyword">sizeof</span>(TopLeafMoments[0]) * <a class="code" href="domain_8c.html#a1c853817a113e66c3d16ad1216733919">NTopLeaves</a>);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">for</span>(i = <a class="code" href="domain_8c.html#a62340ea6340b64acca77b6a488be1983">Tasks</a>[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].StartLeaf; i &lt; <a class="code" href="domain_8c.html#a62340ea6340b64acca77b6a488be1983">Tasks</a>[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>].<a class="code" href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">EndLeaf</a>; i ++) {</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        no = <a class="code" href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a>[i].Task != <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(131231231, <span class="stringliteral">&quot;TopLeave&#39;s Task table is corrupted&quot;</span>);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="comment">/* read out the multipole moments from the local base cells */</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        TopLeafMoments[i].s[0] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[0];</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        TopLeafMoments[i].s[1] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[1];</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        TopLeafMoments[i].s[2] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[2];</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        TopLeafMoments[i].mass = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        TopLeafMoments[i].hmax = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        TopLeafMoments[i].MaxSoftening = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.MaxSoftening;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        TopLeafMoments[i].MixedSofteningsInNode = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">MixedSofteningsInNode</a>;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="comment">/*Set the local base nodes dependence on local mass*/</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordflow">while</span>(no &gt;= 0)</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        {</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].f.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a>)</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a> = 1;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            no = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        }</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    }</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">/* share the pseudo-particle data accross CPUs */</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    recvcounts = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;recvcounts&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    recvoffset = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;recvoffset&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordflow">for</span>(recvTask = 0; recvTask &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; recvTask++)</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    {</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        recvoffset[recvTask] = <a class="code" href="domain_8c.html#a62340ea6340b64acca77b6a488be1983">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a> * <span class="keyword">sizeof</span>(TopLeafMoments[0]);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        recvcounts[recvTask] = (<a class="code" href="domain_8c.html#a62340ea6340b64acca77b6a488be1983">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">EndLeaf</a> - <a class="code" href="domain_8c.html#a62340ea6340b64acca77b6a488be1983">Tasks</a>[recvTask].<a class="code" href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">StartLeaf</a>) * <span class="keyword">sizeof</span>(TopLeafMoments[0]);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    }</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    MPI_Allgatherv(MPI_IN_PLACE, 0, MPI_DATATYPE_NULL,</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            &amp;TopLeafMoments[0], recvcounts, recvoffset,</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            MPI_BYTE, MPI_COMM_WORLD);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(recvoffset);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(recvcounts);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keywordflow">for</span>(ta = 0; ta &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; ta++) {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="keywordflow">if</span>(ta == <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>) <span class="keywordflow">continue</span>; <span class="comment">/* bypass ThisTask since it is already up to date */</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <span class="keywordflow">for</span>(i = <a class="code" href="domain_8c.html#a62340ea6340b64acca77b6a488be1983">Tasks</a>[ta].StartLeaf; i &lt; <a class="code" href="domain_8c.html#a62340ea6340b64acca77b6a488be1983">Tasks</a>[ta].<a class="code" href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">EndLeaf</a>; i ++) {</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            no = <a class="code" href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[0] = TopLeafMoments[i].s[0];</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[1] = TopLeafMoments[i].s[1];</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[2] = TopLeafMoments[i].s[2];</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass = TopLeafMoments[i].mass;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax = TopLeafMoments[i].hmax;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.MaxSoftening = TopLeafMoments[i].MaxSoftening;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">MixedSofteningsInNode</a> = TopLeafMoments[i].MixedSofteningsInNode;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;         }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    }</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(TopLeafMoments);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;}</div><div class="ttc" id="mymalloc_8h_html_af469c2f7e504a771f5d8a91ac9623240"><div class="ttname"><a href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a></div><div class="ttdeci">#define myfree(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00016">mymalloc.h:16</a></div></div>
<div class="ttc" id="structNODE_html_a721d8801f7caf356aaab78a822a56640"><div class="ttname"><a href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a></div><div class="ttdeci">struct NODE::@10 f</div></div>
<div class="ttc" id="endrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00210">endrun.c:210</a></div></div>
<div class="ttc" id="domain_8c_html_a1c853817a113e66c3d16ad1216733919"><div class="ttname"><a href="domain_8c.html#a1c853817a113e66c3d16ad1216733919">NTopLeaves</a></div><div class="ttdeci">int NTopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00055">domain.c:55</a></div></div>
<div class="ttc" id="domain_8c_html_a62340ea6340b64acca77b6a488be1983"><div class="ttname"><a href="domain_8c.html#a62340ea6340b64acca77b6a488be1983">Tasks</a></div><div class="ttdeci">struct task_data * Tasks</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00078">domain.c:78</a></div></div>
<div class="ttc" id="structNODE_html_a7f339ed4a80e4bc82506fdab65a7d655"><div class="ttname"><a href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a></div><div class="ttdeci">struct NODE::@11::@12 d</div></div>
<div class="ttc" id="structNODE_html_a98a1b123b3faa9414fc9a82a5556951c"><div class="ttname"><a href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">NODE::MixedSofteningsInNode</a></div><div class="ttdeci">unsigned int MixedSofteningsInNode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00021">forcetree.h:21</a></div></div>
<div class="ttc" id="structNODE_html_a1ff8c5e570722798d188c60455312fa2"><div class="ttname"><a href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">NODE::DependsOnLocalMass</a></div><div class="ttdeci">unsigned int DependsOnLocalMass</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00020">forcetree.h:20</a></div></div>
<div class="ttc" id="allvars_8c_html_a675acdcd149f5993271a1fdc11673b65"><div class="ttname"><a href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a></div><div class="ttdeci">int NTask</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8c_source.html#l00025">allvars.c:25</a></div></div>
<div class="ttc" id="allvars_8c_html_a52c8c7d2abff436111942e02c5bb466a"><div class="ttname"><a href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a></div><div class="ttdeci">int ThisTask</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8c_source.html#l00024">allvars.c:24</a></div></div>
<div class="ttc" id="auxiliary__functions_8c_html_ac9562ee4ecb3b8aeebeb04656e7e57a9"><div class="ttname"><a href="auxiliary__functions_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a></div><div class="ttdeci">#define s</div><div class="ttdef"><b>Definition:</b> <a href="auxiliary__functions_8c_source.html#l00014">auxiliary_functions.c:14</a></div></div>
<div class="ttc" id="mymalloc_8h_html_a3eb707b32b6ac69f2df085e4bc098cc4"><div class="ttname"><a href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a></div><div class="ttdeci">#define mymalloc(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00012">mymalloc.h:12</a></div></div>
<div class="ttc" id="domain_8c_html_aba985e8ae49746e598c581da7631076e"><div class="ttname"><a href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a></div><div class="ttdeci">struct topleaf_data * TopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00051">domain.c:51</a></div></div>
<div class="ttc" id="structtask__data_html_adb9ec65f9257aa87c1811f283061ef4b"><div class="ttname"><a href="structtask__data.html#adb9ec65f9257aa87c1811f283061ef4b">task_data::StartLeaf</a></div><div class="ttdeci">int StartLeaf</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00026">domain.h:26</a></div></div>
<div class="ttc" id="structNODE_html_a9a1b7edbe811165e40220f63a38f2d16"><div class="ttname"><a href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">NODE::father</a></div><div class="ttdeci">int father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00016">forcetree.h:16</a></div></div>
<div class="ttc" id="forcetree_8c_html_ac46f89ba3715dfa877c2e1b8822da657"><div class="ttname"><a href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00038">forcetree.c:38</a></div></div>
<div class="ttc" id="types_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00022">types.h:22</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="structtopleaf__data_html_ab948aab0a7ca32817caaaec832643645"><div class="ttname"><a href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">topleaf_data::treenode</a></div><div class="ttdeci">int treenode</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00021">domain.h:21</a></div></div>
<div class="ttc" id="structtask__data_html_a3282c0a233e6ab985c0c9568f2589a6f"><div class="ttname"><a href="structtask__data.html#a3282c0a233e6ab985c0c9568f2589a6f">task_data::EndLeaf</a></div><div class="ttdeci">int EndLeaf</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00027">domain.h:27</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_aaabf16b5e99c9ac6bc6bbe039756bddb_cgraph.svg" width="604" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_aaabf16b5e99c9ac6bc6bbe039756bddb_icgraph.svg" width="1467" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a96d9883368c2630c024e1196e849f07c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96d9883368c2630c024e1196e849f07c">&#9670;&nbsp;</a></span>force_get_next_node()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int force_get_next_node </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td>
          <td class="paramname"><em>tb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00590">590</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a>, <a class="el" href="forcetree_8h_source.html#l00048">TreeBuilder::firstnode</a>, <a class="el" href="forcetree_8h_source.html#l00050">TreeBuilder::lastnode</a>, <a class="el" href="forcetree_8c_source.html#l00046">Nextnode</a>, <a class="el" href="forcetree_8h_source.html#l00053">TreeBuilder::Nodes</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00627">force_get_prev_node()</a>, <a class="el" href="forcetree_8c_source.html#l00707">force_update_node_recursive()</a>, <a class="el" href="forcetree_8c_source.html#l00247">modify_internal_node()</a>, and <a class="el" href="forcetree_8h_source.html#l00084">node_is_node()</a>.</p>
<div class="fragment"><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;{</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">if</span>(no &gt;= tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a> &amp;&amp; no &lt; tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="comment">/* internal node */</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">return</span> tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.nextnode;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span>(no &lt; tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>) {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="comment">/* Particle */</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[no];</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    }</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">else</span> { <span class="comment">//if(no &gt;= PartManager-&gt;MaxPart + MaxNodes) {</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="comment">/* Pseudo Particle */</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[no - (tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a> - tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>)];</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;}</div><div class="ttc" id="structNODE_html_a7f339ed4a80e4bc82506fdab65a7d655"><div class="ttname"><a href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a></div><div class="ttdeci">struct NODE::@11::@12 d</div></div>
<div class="ttc" id="forcetree_8c_html_ad14ab43f541f9c33cb9222ea018c1365"><div class="ttname"><a href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a></div><div class="ttdeci">int * Nextnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00046">forcetree.c:46</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a981968a8f087ebb1f27c385bc5eac7d2"><div class="ttname"><a href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">TreeBuilder::firstnode</a></div><div class="ttdeci">int firstnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00048">forcetree.h:48</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="structTreeBuilder_html_a3ab6259028cdd8013165ce13b0a28e4e"><div class="ttname"><a href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">TreeBuilder::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00050">forcetree.h:50</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a83a6e131b8f124c7f6c8f242893016ce"><div class="ttname"><a href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">TreeBuilder::Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00053">forcetree.h:53</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a96d9883368c2630c024e1196e849f07c_icgraph.svg" width="2058" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7a6cf9ad0fab6ccef833c29596fb92fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a6cf9ad0fab6ccef833c29596fb92fd">&#9670;&nbsp;</a></span>force_get_prev_node()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int force_get_prev_node </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td>
          <td class="paramname"><em>tb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00627">627</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="endrun_8c_source.html#l00210">endrun()</a>, <a class="el" href="forcetree_8c_source.html#l00047">Father</a>, <a class="el" href="forcetree_8c_source.html#l00590">force_get_next_node()</a>, and <a class="el" href="forcetree_8h_source.html#l00078">node_is_particle()</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8h_source.html#l00084">node_is_node()</a>.</p>
<div class="fragment"><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;{</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="forcetree_8h.html#ab0b97330acbcb19fd8b847d05c842842">node_is_particle</a>(no)) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="comment">/* Particle */</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="keywordtype">int</span> t = <a class="code" href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>[no];</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordtype">int</span> next = <a class="code" href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a>(t, tb);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keywordflow">while</span>(next != no) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            t = next;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            next = <a class="code" href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a>(t, tb);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">return</span> t;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="comment">/* not implemented yet */</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(1, <span class="stringliteral">&quot;get_prev_node on non particles is not implemented yet\n&quot;</span>);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    }</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;}</div><div class="ttc" id="endrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00210">endrun.c:210</a></div></div>
<div class="ttc" id="forcetree_8c_html_ae1adfde6b271afd077130a64e6b85766"><div class="ttname"><a href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a></div><div class="ttdeci">int * Father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00047">forcetree.c:47</a></div></div>
<div class="ttc" id="forcetree_8h_html_ab0b97330acbcb19fd8b847d05c842842"><div class="ttname"><a href="forcetree_8h.html#ab0b97330acbcb19fd8b847d05c842842">node_is_particle</a></div><div class="ttdeci">static int node_is_particle(int no)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00078">forcetree.h:78</a></div></div>
<div class="ttc" id="forcetree_8c_html_a96d9883368c2630c024e1196e849f07c"><div class="ttname"><a href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a></div><div class="ttdeci">int force_get_next_node(int no, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00590">forcetree.c:590</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a7a6cf9ad0fab6ccef833c29596fb92fd_cgraph.svg" width="640" height="164"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a7a6cf9ad0fab6ccef833c29596fb92fd_icgraph.svg" width="304" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5dd5b4b96039c79e703efd5106ca012a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dd5b4b96039c79e703efd5106ca012a">&#9670;&nbsp;</a></span>force_insert_pseudo_particles()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void force_insert_pseudo_particles </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td>
          <td class="paramname"><em>tb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>this function inserts pseudo-particles which will represent the mass distribution of the other CPUs. Initially, the mass of the pseudo-particles is set to zero, and their coordinate is set to the center of the domain-cell they correspond to. These quantities will be updated later on. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00573">573</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8c_source.html#l00607">force_set_next_node()</a>, <a class="el" href="forcetree_8h_source.html#l00050">TreeBuilder::lastnode</a>, <a class="el" href="forcetree_8h_source.html#l00053">TreeBuilder::Nodes</a>, <a class="el" href="domain_8c_source.html#l00055">NTopLeaves</a>, <a class="el" href="forcetree_8h_source.html#l00025">NODE::suns</a>, <a class="el" href="allvars_8c_source.html#l00024">ThisTask</a>, <a class="el" href="domain_8c_source.html#l00051">TopLeaves</a>, <a class="el" href="domain_8h_source.html#l00021">topleaf_data::treenode</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00490">force_tree_build_single()</a>.</p>
<div class="fragment"><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;{</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordtype">int</span> i, index;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> firstpseudo = tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="domain_8c.html#a1c853817a113e66c3d16ad1216733919">NTopLeaves</a>; i++)</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        index = <a class="code" href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a>[i].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a>[i].Task != <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[index].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[0] = firstpseudo + i;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <a class="code" href="forcetree_8c.html#a8571da12c389bfcf10555865a0e3882d">force_set_next_node</a>(firstpseudo + i, -1, tb);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div><div class="ttc" id="domain_8c_html_a1c853817a113e66c3d16ad1216733919"><div class="ttname"><a href="domain_8c.html#a1c853817a113e66c3d16ad1216733919">NTopLeaves</a></div><div class="ttdeci">int NTopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00055">domain.c:55</a></div></div>
<div class="ttc" id="forcetree_8c_html_a8571da12c389bfcf10555865a0e3882d"><div class="ttname"><a href="forcetree_8c.html#a8571da12c389bfcf10555865a0e3882d">force_set_next_node</a></div><div class="ttdeci">int force_set_next_node(int no, int next, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00607">forcetree.c:607</a></div></div>
<div class="ttc" id="allvars_8c_html_a52c8c7d2abff436111942e02c5bb466a"><div class="ttname"><a href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a></div><div class="ttdeci">int ThisTask</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8c_source.html#l00024">allvars.c:24</a></div></div>
<div class="ttc" id="domain_8c_html_aba985e8ae49746e598c581da7631076e"><div class="ttname"><a href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a></div><div class="ttdeci">struct topleaf_data * TopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00051">domain.c:51</a></div></div>
<div class="ttc" id="structNODE_html_a2a31ed85a69cd67dce1861bd327ac6e9"><div class="ttname"><a href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">NODE::suns</a></div><div class="ttdeci">int suns[8]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00025">forcetree.h:25</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="structTreeBuilder_html_a3ab6259028cdd8013165ce13b0a28e4e"><div class="ttname"><a href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">TreeBuilder::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00050">forcetree.h:50</a></div></div>
<div class="ttc" id="structtopleaf__data_html_ab948aab0a7ca32817caaaec832643645"><div class="ttname"><a href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">topleaf_data::treenode</a></div><div class="ttdeci">int treenode</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00021">domain.h:21</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a83a6e131b8f124c7f6c8f242893016ce"><div class="ttname"><a href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">TreeBuilder::Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00053">forcetree.h:53</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a5dd5b4b96039c79e703efd5106ca012a_cgraph.svg" width="340" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a5dd5b4b96039c79e703efd5106ca012a_icgraph.svg" width="1620" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8571da12c389bfcf10555865a0e3882d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8571da12c389bfcf10555865a0e3882d">&#9670;&nbsp;</a></span>force_set_next_node()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int force_set_next_node </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>next</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td>
          <td class="paramname"><em>tb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00607">607</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a>, <a class="el" href="forcetree_8h_source.html#l00048">TreeBuilder::firstnode</a>, <a class="el" href="forcetree_8h_source.html#l00050">TreeBuilder::lastnode</a>, <a class="el" href="forcetree_8c_source.html#l00046">Nextnode</a>, <a class="el" href="forcetree_8h_source.html#l00053">TreeBuilder::Nodes</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00573">force_insert_pseudo_particles()</a>, <a class="el" href="forcetree_8c_source.html#l00490">force_tree_build_single()</a>, <a class="el" href="forcetree_8c_source.html#l00707">force_update_node_recursive()</a>, <a class="el" href="forcetree_8c_source.html#l00247">modify_internal_node()</a>, and <a class="el" href="forcetree_8h_source.html#l00084">node_is_node()</a>.</p>
<div class="fragment"><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;{</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">if</span>(no &lt; 0) <span class="keywordflow">return</span> next;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">if</span>(no &gt;= tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a> &amp;&amp; no &lt; tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>) {</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="comment">/* internal node */</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.nextnode = next;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">if</span>(no &lt; tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>) {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="comment">/* Particle */</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <a class="code" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[no] = next;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span>(no &gt;= tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="comment">/* Pseudo Particle */</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <a class="code" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[no - (tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a> - tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>)] = next;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    }</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">return</span> next;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;}</div><div class="ttc" id="structNODE_html_a7f339ed4a80e4bc82506fdab65a7d655"><div class="ttname"><a href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a></div><div class="ttdeci">struct NODE::@11::@12 d</div></div>
<div class="ttc" id="forcetree_8c_html_ad14ab43f541f9c33cb9222ea018c1365"><div class="ttname"><a href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a></div><div class="ttdeci">int * Nextnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00046">forcetree.c:46</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a981968a8f087ebb1f27c385bc5eac7d2"><div class="ttname"><a href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">TreeBuilder::firstnode</a></div><div class="ttdeci">int firstnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00048">forcetree.h:48</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="structTreeBuilder_html_a3ab6259028cdd8013165ce13b0a28e4e"><div class="ttname"><a href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">TreeBuilder::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00050">forcetree.h:50</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a83a6e131b8f124c7f6c8f242893016ce"><div class="ttname"><a href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">TreeBuilder::Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00053">forcetree.h:53</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a8571da12c389bfcf10555865a0e3882d_icgraph.svg" width="2058" height="367"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa1174e5cc4c75944aa98706941a70db9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1174e5cc4c75944aa98706941a70db9">&#9670;&nbsp;</a></span>force_tree_allocated()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int force_tree_allocated </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00095">95</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8c_source.html#l00049">tree_allocated_flag</a>.</p>

<p class="reference">Referenced by <a class="el" href="gravpm_8c_source.html#l00108">_prepare()</a>, <a class="el" href="domain_8c_source.html#l00133">domain_decompose_full()</a>, <a class="el" href="domain_8c_source.html#l00224">domain_maintain()</a>, <a class="el" href="forcetree_8c_source.html#l00101">force_tree_rebuild()</a>, and <a class="el" href="treewalk_8c_source.html#l00543">treewalk_run()</a>.</p>
<div class="fragment"><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;{</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="forcetree_8c.html#a74c0df66a077bd271e68e460f36d2169">tree_allocated_flag</a>;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;}</div><div class="ttc" id="forcetree_8c_html_a74c0df66a077bd271e68e460f36d2169"><div class="ttname"><a href="forcetree_8c.html#a74c0df66a077bd271e68e460f36d2169">tree_allocated_flag</a></div><div class="ttdeci">static int tree_allocated_flag</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00049">forcetree.c:49</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_aa1174e5cc4c75944aa98706941a70db9_icgraph.svg" width="1948" height="854"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a69350a797a01322b05ec26913d2fa62d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69350a797a01322b05ec26913d2fa62d">&#9670;&nbsp;</a></span>force_tree_build()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int force_tree_build </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>npart</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This function is a driver routine for constructing the gravitational oct-tree, which is done by calling a small number of other functions. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00121">121</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="allvars_8c_source.html#l00047">All</a>, <a class="el" href="io_8c_source.html#l00050">dump_snapshot()</a>, <a class="el" href="endrun_8c_source.html#l00210">endrun()</a>, <a class="el" href="event_8c_source.html#l00006">event_listen()</a>, <a class="el" href="event_8c_source.html#l00054">EventSlotsFork</a>, <a class="el" href="forcetree_8c_source.html#l00815">force_exchange_pseudodata()</a>, <a class="el" href="forcetree_8c_source.html#l00490">force_tree_build_single()</a>, <a class="el" href="forcetree_8c_source.html#l00079">force_tree_eh_slots_fork()</a>, <a class="el" href="forcetree_8c_source.html#l01115">force_tree_free()</a>, <a class="el" href="forcetree_8c_source.html#l01086">force_treeallocate()</a>, <a class="el" href="forcetree_8c_source.html#l00902">force_treeupdate_pseudos()</a>, <a class="el" href="partmanager_8h_source.html#l00095">part_manager_type::MaxPart</a>, <a class="el" href="endrun_8c_source.html#l00226">message()</a>, <a class="el" href="domain_8c_source.html#l00055">NTopNodes</a>, <a class="el" href="partmanager_8c_source.html#l00009">PartManager</a>, and <a class="el" href="allvars_8h_source.html#l00187">global_data_all_processes::TreeAllocFactor</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00101">force_tree_rebuild()</a>.</p>
<div class="fragment"><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">int</span> Numnodestree;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">int</span> flag;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">int</span> maxnodes;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keyword">struct </span><a class="code" href="structTreeBuilder.html">TreeBuilder</a> tb;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">do</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        maxnodes = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a> * <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a9440ed5de8d085c00358b2677f5d8c7b">MaxPart</a> + <a class="code" href="domain_8c.html#a9e9f84aad826ef9cbb960944e88efd6b">NTopNodes</a>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="comment">/* construct tree if needed */</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="comment">/* the tree is used in grav dens, hydro, bh and sfr */</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        tb = <a class="code" href="forcetree_8c.html#a9c3f496b74e5a0099d41f36e05c2a787">force_treeallocate</a>(maxnodes, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a9440ed5de8d085c00358b2677f5d8c7b">MaxPart</a>, <a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a9440ed5de8d085c00358b2677f5d8c7b">MaxPart</a>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        Numnodestree = <a class="code" href="forcetree_8c.html#aac1fca475cd9acc615f8e86d04198a2f">force_tree_build_single</a>(tb, npart);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">if</span>(Numnodestree &lt; 0)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(1, <span class="stringliteral">&quot;Not enough tree nodes (%d) for %d particles.\n&quot;</span>, maxnodes, npart);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        MPI_Allreduce(&amp;Numnodestree, &amp;flag, 1, MPI_INT, MPI_MIN, MPI_COMM_WORLD);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">if</span>(flag == -1)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <a class="code" href="forcetree_8c.html#a2ae933e7b7e909142281bae26f95cd00">force_tree_free</a>();</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;TreeAllocFactor from %g to %g\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a>*1.15);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a> *= 1.15;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a> &gt; 5.0)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;An excessively large number of tree nodes were required, stopping with particle dump.\n&quot;</span>);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                <a class="code" href="io_8c.html#ab2f2e3ccf056f3f09f214d41d60987b0">dump_snapshot</a>();</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(0, <span class="stringliteral">&quot;Too many tree nodes, snapshot saved.&quot;</span>);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">while</span>(flag == -1);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="forcetree_8c.html#aaabf16b5e99c9ac6bc6bbe039756bddb">force_exchange_pseudodata</a>();</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="forcetree_8c.html#a4b2e6ceda1e6b5ca4469148b13bff5dc">force_treeupdate_pseudos</a>(<a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#a9440ed5de8d085c00358b2677f5d8c7b">MaxPart</a>, tb);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="event_8c.html#a3f548c264e5e5b9fe2bb8b10c177482a">event_listen</a>(&amp;<a class="code" href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a>, <a class="code" href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a>, NULL);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">return</span> Numnodestree;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div><div class="ttc" id="forcetree_8c_html_aaabf16b5e99c9ac6bc6bbe039756bddb"><div class="ttname"><a href="forcetree_8c.html#aaabf16b5e99c9ac6bc6bbe039756bddb">force_exchange_pseudodata</a></div><div class="ttdeci">static void force_exchange_pseudodata(void)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00815">forcetree.c:815</a></div></div>
<div class="ttc" id="event_8c_html_aafc3f0c1fffb6f0a19f5f3ecd24474c7"><div class="ttname"><a href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a></div><div class="ttdeci">EventSpec EventSlotsFork</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00054">event.c:54</a></div></div>
<div class="ttc" id="endrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00210">endrun.c:210</a></div></div>
<div class="ttc" id="forcetree_8c_html_a4b2e6ceda1e6b5ca4469148b13bff5dc"><div class="ttname"><a href="forcetree_8c.html#a4b2e6ceda1e6b5ca4469148b13bff5dc">force_treeupdate_pseudos</a></div><div class="ttdeci">static void force_treeupdate_pseudos(int no, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00902">forcetree.c:902</a></div></div>
<div class="ttc" id="forcetree_8c_html_a6c833489d009e4b5e850dc5997214775"><div class="ttname"><a href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a></div><div class="ttdeci">static int force_tree_eh_slots_fork(EIBase *event, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00079">forcetree.c:79</a></div></div>
<div class="ttc" id="forcetree_8c_html_a9c3f496b74e5a0099d41f36e05c2a787"><div class="ttname"><a href="forcetree_8c.html#a9c3f496b74e5a0099d41f36e05c2a787">force_treeallocate</a></div><div class="ttdeci">struct TreeBuilder force_treeallocate(int maxnodes, int maxpart, int first_node_offset)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01086">forcetree.c:1086</a></div></div>
<div class="ttc" id="structpart__manager__type_html_a9440ed5de8d085c00358b2677f5d8c7b"><div class="ttname"><a href="structpart__manager__type.html#a9440ed5de8d085c00358b2677f5d8c7b">part_manager_type::MaxPart</a></div><div class="ttdeci">int MaxPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00095">partmanager.h:95</a></div></div>
<div class="ttc" id="forcetree_8c_html_a2ae933e7b7e909142281bae26f95cd00"><div class="ttname"><a href="forcetree_8c.html#a2ae933e7b7e909142281bae26f95cd00">force_tree_free</a></div><div class="ttdeci">void force_tree_free(void)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01115">forcetree.c:1115</a></div></div>
<div class="ttc" id="event_8c_html_a3f548c264e5e5b9fe2bb8b10c177482a"><div class="ttname"><a href="event_8c.html#a3f548c264e5e5b9fe2bb8b10c177482a">event_listen</a></div><div class="ttdeci">int event_listen(EventSpec *eh, eventfunc func, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00006">event.c:6</a></div></div>
<div class="ttc" id="endrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00226">endrun.c:226</a></div></div>
<div class="ttc" id="domain_8c_html_a9e9f84aad826ef9cbb960944e88efd6b"><div class="ttname"><a href="domain_8c.html#a9e9f84aad826ef9cbb960944e88efd6b">NTopNodes</a></div><div class="ttdeci">int NTopNodes</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00055">domain.c:55</a></div></div>
<div class="ttc" id="structglobal__data__all__processes_html_a374a92c40b930e388b7180b8862c3670"><div class="ttname"><a href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">global_data_all_processes::TreeAllocFactor</a></div><div class="ttdeci">double TreeAllocFactor</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8h_source.html#l00187">allvars.h:187</a></div></div>
<div class="ttc" id="partmanager_8c_html_a6cef44682776e476d8f9f1b9e1f9fe16"><div class="ttname"><a href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a></div><div class="ttdeci">struct part_manager_type PartManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8c_source.html#l00009">partmanager.c:9</a></div></div>
<div class="ttc" id="forcetree_8c_html_aac1fca475cd9acc615f8e86d04198a2f"><div class="ttname"><a href="forcetree_8c.html#aac1fca475cd9acc615f8e86d04198a2f">force_tree_build_single</a></div><div class="ttdeci">static int force_tree_build_single(const struct TreeBuilder tb, const int npart)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00490">forcetree.c:490</a></div></div>
<div class="ttc" id="structTreeBuilder_html"><div class="ttname"><a href="structTreeBuilder.html">TreeBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00046">forcetree.h:46</a></div></div>
<div class="ttc" id="io_8c_html_ab2f2e3ccf056f3f09f214d41d60987b0"><div class="ttname"><a href="io_8c.html#ab2f2e3ccf056f3f09f214d41d60987b0">dump_snapshot</a></div><div class="ttdeci">void dump_snapshot()</div><div class="ttdef"><b>Definition:</b> <a href="io_8c_source.html#l00050">io.c:50</a></div></div>
<div class="ttc" id="allvars_8c_html_ad49123ae0461ffe61629a0d4cf2ba91f"><div class="ttname"><a href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a></div><div class="ttdeci">struct global_data_all_processes All</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8c_source.html#l00047">allvars.c:47</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a69350a797a01322b05ec26913d2fa62d_cgraph.svg" width="1787" height="1176"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a69350a797a01322b05ec26913d2fa62d_icgraph.svg" width="1231" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aac1fca475cd9acc615f8e86d04198a2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac1fca475cd9acc615f8e86d04198a2f">&#9670;&nbsp;</a></span>force_tree_build_single()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int force_tree_build_single </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td>
          <td class="paramname"><em>tb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>npart</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Constructs the gravitational oct-tree.</p>
<p>The index convention for accessing tree nodes is the following: the indices 0...NumPart-1 reference single particles, the indices PartManager-&gt;MaxPart.... PartManager-&gt;MaxPart+nodes-1 reference tree nodes. `Nodes_base' points to the first tree node, while `nodes' is shifted such that nodes[PartManager-&gt;MaxPart] gives the first tree node. Finally, node indices with values 'PartManager-&gt;MaxPart + MaxNodes' and larger indicate "pseudo
particles", i.e. multipole moments of top-level nodes that lie on different CPUs. If such a node needs to be opened, the corresponding particle must be exported to that CPU. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00490">490</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00048">TreeBuilder::firstnode</a>, <a class="el" href="forcetree_8c_source.html#l00573">force_insert_pseudo_particles()</a>, <a class="el" href="forcetree_8c_source.html#l00607">force_set_next_node()</a>, <a class="el" href="forcetree_8c_source.html#l00333">force_tree_create_nodes()</a>, <a class="el" href="forcetree_8c_source.html#l00707">force_update_node_recursive()</a>, and <a class="el" href="forcetree_8h_source.html#l00050">TreeBuilder::lastnode</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00121">force_tree_build()</a>.</p>
<div class="fragment"><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;{</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordtype">int</span> nnext = <a class="code" href="forcetree_8c.html#ab571f41f30d0859373efe8f65b6523b2">force_tree_create_nodes</a>(tb, npart);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span>(nnext &gt;= tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a> - tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>)</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="comment">/* insert the pseudo particles that represent the mass distribution of other domains */</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="forcetree_8c.html#a5dd5b4b96039c79e703efd5106ca012a">force_insert_pseudo_particles</a>(tb);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">/* now compute the multipole moments recursively */</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordtype">int</span> tail = <a class="code" href="forcetree_8c.html#a079d4156d4368c439545f14fcf81878f">force_update_node_recursive</a>(tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>, -1, -1, tb);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="forcetree_8c.html#a8571da12c389bfcf10555865a0e3882d">force_set_next_node</a>(tail, -1, tb);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">return</span> nnext;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;}</div><div class="ttc" id="forcetree_8c_html_a5dd5b4b96039c79e703efd5106ca012a"><div class="ttname"><a href="forcetree_8c.html#a5dd5b4b96039c79e703efd5106ca012a">force_insert_pseudo_particles</a></div><div class="ttdeci">static void force_insert_pseudo_particles(const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00573">forcetree.c:573</a></div></div>
<div class="ttc" id="forcetree_8c_html_ab571f41f30d0859373efe8f65b6523b2"><div class="ttname"><a href="forcetree_8c.html#ab571f41f30d0859373efe8f65b6523b2">force_tree_create_nodes</a></div><div class="ttdeci">int force_tree_create_nodes(const struct TreeBuilder tb, const int npart)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00333">forcetree.c:333</a></div></div>
<div class="ttc" id="forcetree_8c_html_a8571da12c389bfcf10555865a0e3882d"><div class="ttname"><a href="forcetree_8c.html#a8571da12c389bfcf10555865a0e3882d">force_set_next_node</a></div><div class="ttdeci">int force_set_next_node(int no, int next, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00607">forcetree.c:607</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a981968a8f087ebb1f27c385bc5eac7d2"><div class="ttname"><a href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">TreeBuilder::firstnode</a></div><div class="ttdeci">int firstnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00048">forcetree.h:48</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a3ab6259028cdd8013165ce13b0a28e4e"><div class="ttname"><a href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">TreeBuilder::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00050">forcetree.h:50</a></div></div>
<div class="ttc" id="forcetree_8c_html_a079d4156d4368c439545f14fcf81878f"><div class="ttname"><a href="forcetree_8c.html#a079d4156d4368c439545f14fcf81878f">force_update_node_recursive</a></div><div class="ttdeci">int force_update_node_recursive(int no, int sib, int tail, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00707">forcetree.c:707</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_aac1fca475cd9acc615f8e86d04198a2f_cgraph.svg" width="1215" height="627"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_aac1fca475cd9acc615f8e86d04198a2f_icgraph.svg" width="1434" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab571f41f30d0859373efe8f65b6523b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab571f41f30d0859373efe8f65b6523b2">&#9670;&nbsp;</a></span>force_tree_create_nodes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int force_tree_create_nodes </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td>
          <td class="paramname"><em>tb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>npart</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Does initial creation of the nodes for the gravitational oct-tree. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00333">333</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="allvars_8c_source.html#l00047">All</a>, <a class="el" href="allvars_8h_source.html#l00160">global_data_all_processes::BoxSize</a>, <a class="el" href="forcetree_8h_source.html#l00014">NODE::center</a>, <a class="el" href="domain_8c_source.html#l00698">domain_get_topleaf()</a>, <a class="el" href="endrun_8c_source.html#l00210">endrun()</a>, <a class="el" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a>, <a class="el" href="forcetree_8h_source.html#l00016">NODE::father</a>, <a class="el" href="forcetree_8h_source.html#l00048">TreeBuilder::firstnode</a>, <a class="el" href="forcetree_8c_source.html#l00518">force_create_node_for_topnode()</a>, <a class="el" href="forcetree_8c_source.html#l00176">get_subnode()</a>, <a class="el" href="forcetree_8c_source.html#l00186">inside_node()</a>, <a class="el" href="forcetree_8h_source.html#l00018">NODE::InternalTopLevel</a>, <a class="el" href="forcetree_8h_source.html#l00050">TreeBuilder::lastnode</a>, <a class="el" href="forcetree_8h_source.html#l00013">NODE::len</a>, <a class="el" href="endrun_8c_source.html#l00226">message()</a>, <a class="el" href="forcetree_8c_source.html#l00247">modify_internal_node()</a>, <a class="el" href="mymalloc_8h_source.html#l00016">myfree</a>, <a class="el" href="mymalloc_8h_source.html#l00012">mymalloc</a>, <a class="el" href="forcetree_8c_source.html#l00225">NodeCache::nnext_thread</a>, <a class="el" href="forcetree_8h_source.html#l00053">TreeBuilder::Nodes</a>, <a class="el" href="forcetree_8c_source.html#l00226">NodeCache::nrem_thread</a>, <a class="el" href="partmanager_8h_source.html#l00099">P</a>, <a class="el" href="forcetree_8h_source.html#l00025">NODE::suns</a>, <a class="el" href="domain_8c_source.html#l00051">TopLeaves</a>, <a class="el" href="forcetree_8h_source.html#l00019">NODE::TopLevel</a>, <a class="el" href="domain_8h_source.html#l00021">topleaf_data::treenode</a>, <a class="el" href="allvars_8h_source.html#l00340">global_data_all_processes::TreeNodeMinSize</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00490">force_tree_build_single()</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;{</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordtype">int</span> nnext = tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>;       <span class="comment">/* index of first free node */</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">/*Minimum size of the node depends on the minimum of all force softenings*/</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> minlen = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab2e58bf8550b3803c6181390bf536c4e">TreeNodeMinSize</a>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">/*Count of how many times we hit this limit*/</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordtype">int</span> closepairs = 0;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">/* create an empty root node  */</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *nfreep = &amp;tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[nnext]; <span class="comment">/* select first node */</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ac1b2e52cf547f5b2fe4bdfb0eaafa22f">BoxSize</a>*1.001;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; 3; i++)</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            nfreep-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[i] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ac1b2e52cf547f5b2fe4bdfb0eaafa22f">BoxSize</a>/2.;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; 8; i++)</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            nfreep-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[i] = -1;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = -1;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a> = 1;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a> = 0;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        nnext++;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="comment">/* create a set of empty nodes corresponding to the top-level domain</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">         * grid. We need to generate these nodes first to make sure that we have a</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">         * complete top-level tree which allows the easy insertion of the</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">         * pseudo-particles in the right place */</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <a class="code" href="forcetree_8c.html#ad8ee13a12eb949d8554c8d413b684a80">force_create_node_for_topnode</a>(tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>, 0, 1, 0, 0, 0, &amp;nnext, tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">/* This implements a small thread-local free Node cache.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">     * The cache ensures that Nodes from the same (or close) particles</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">     * are created close to each other on the Node list and thus</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">     * helps cache locality. In my tests without this list the</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">     * reduction in cache performance destroyed the benefit of</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">     * parallelizing this loop!*/</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keyword">struct </span><a class="code" href="structNodeCache.html">NodeCache</a> nc;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    nc.<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> = nnext;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    nc.nrem_thread = 0;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">/* Stores the last-seen node on this thread.</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">     * Since most particles are close to each other, this should save a number of tree walks.*/</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordtype">int</span> this_acc = tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">/* now we insert all particles */</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="preprocessor">#ifdef OPENMP_USE_SPINLOCK</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">/*Initialise some spinlocks off*/</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    pthread_spinlock_t * SpinLocks = <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;NodeSpinlocks&quot;</span>, (tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a> - tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>)*<span class="keyword">sizeof</span>(pthread_spinlock_t));</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">for</span>(i=0; i &lt; tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a> - tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>; i++) {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        pthread_spin_init(&amp;SpinLocks[i],PTHREAD_PROCESS_PRIVATE);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor">    #pragma omp parallel for firstprivate(nc, this_acc) reduction(+: closepairs)</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; npart; i++)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].SufferFromCoupling = 0;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="comment">/*Can&#39;t break from openmp for*/</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">if</span>(nc.nnext_thread &gt;= tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>-1)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="comment">/*First find the Node for the TopLeaf */</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordtype">int</span> <span class="keyword">this</span>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#ab3ee27767a982ea77a18f5f4983e4344">inside_node</a>(&amp;tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[this_acc], i)) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keyword">this</span> = this_acc;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> topleaf = <a class="code" href="domain_8c.html#ab933a4fc02cd61de36a066634c7c7a5b">domain_get_topleaf</a>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[i].Key);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="keyword">this</span> = <a class="code" href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a>[topleaf].<a class="code" href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">treenode</a>;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordtype">int</span> child, subnode;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="comment">/*Walk the main tree until we get something that isn&#39;t an internal node.*/</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">do</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="comment">/*We will always start with an internal node: find the desired subnode.*/</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            subnode = <a class="code" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a>(&amp;tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[<span class="keyword">this</span>], i);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            <span class="comment">/*No lock needed: if we have an internal node here it will be stable*/</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="preprocessor">            #pragma omp atomic read</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            child = tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[<span class="keyword">this</span>].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[subnode];</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">if</span>(child &gt; tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(1,<span class="stringliteral">&quot;Corruption in tree build: N[%d].[%d] = %d &gt; lastnode (%d)\n&quot;</span>,<span class="keyword">this</span>, subnode, child, tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="comment">/* If we found an internal node keep walking*/</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(child &gt;= tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>) {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                <span class="keyword">this</span> = child;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">while</span>(child &gt;= tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="preprocessor">#ifdef OPENMP_USE_SPINLOCK</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="comment">/*Now lock this node.*/</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        pthread_spin_lock(&amp;SpinLocks[<span class="keyword">this</span>-tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>]);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="comment">/*Check nothing changed when we took the lock*/</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="preprocessor">        #pragma omp atomic read</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        child = tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[<span class="keyword">this</span>].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[subnode];</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="comment">/*If it did, walk again*/</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">while</span>(child &gt;= tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>)</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="preprocessor">#ifdef OPENMP_USE_SPINLOCK</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="comment">/*Move the lock to the child*/</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            pthread_spin_lock(&amp;SpinLocks[child-tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>]);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            pthread_spin_unlock(&amp;SpinLocks[<span class="keyword">this</span>-tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>]);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keyword">this</span> = child;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <span class="comment">/*New subnode*/</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            subnode = <a class="code" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a>(&amp;tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[<span class="keyword">this</span>], i);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="preprocessor">            #pragma omp atomic read</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            child = tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[<span class="keyword">this</span>].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[subnode];</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="comment">/*Update last-used cache*/</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        this_acc = <span class="keyword">this</span>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="comment">/* Now we have something that isn&#39;t an internal node, and we have a lock on it,</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">         * so we know it won&#39;t change. We can place the particle! */</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <a class="code" href="forcetree_8c.html#a7206eeadd2231b432e8c0932fd23b1e5">modify_internal_node</a>(<span class="keyword">this</span>, subnode, child, i, tb, &amp;nnext, &amp;nc, minlen, &amp;closepairs);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="comment">/* Add an explicit flush because we are not using openmp&#39;s critical sections */</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="preprocessor">        #pragma omp flush</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor">#ifdef OPENMP_USE_SPINLOCK</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="comment">/*Unlock the parent*/</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        pthread_spin_unlock(&amp;SpinLocks[<span class="keyword">this</span> - tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>]);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    }</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordtype">int</span> totclose;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    MPI_Allreduce(&amp;closepairs, &amp;totclose, 1, MPI_INT, MPI_SUM, MPI_COMM_WORLD);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">if</span>(totclose) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0,<span class="stringliteral">&quot;Found %d close particle pairs when building tree.\n&quot;</span>,totclose);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    }</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor">#ifdef OPENMP_USE_SPINLOCK</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">for</span>(i=0; i &lt; tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a> - tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>; i++)</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            pthread_spin_destroy(&amp;SpinLocks[i]);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">/*Avoid a warning about discarding volatile*/</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordtype">int</span> * ss = (<span class="keywordtype">int</span> *) SpinLocks;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(ss);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">return</span> nnext - tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;}</div><div class="ttc" id="mymalloc_8h_html_af469c2f7e504a771f5d8a91ac9623240"><div class="ttname"><a href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a></div><div class="ttdeci">#define myfree(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00016">mymalloc.h:16</a></div></div>
<div class="ttc" id="domain_8c_html_ab933a4fc02cd61de36a066634c7c7a5b"><div class="ttname"><a href="domain_8c.html#ab933a4fc02cd61de36a066634c7c7a5b">domain_get_topleaf</a></div><div class="ttdeci">int domain_get_topleaf(const peano_t key)</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00698">domain.c:698</a></div></div>
<div class="ttc" id="structNODE_html_a721d8801f7caf356aaab78a822a56640"><div class="ttname"><a href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a></div><div class="ttdeci">struct NODE::@10 f</div></div>
<div class="ttc" id="partmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00099">partmanager.h:99</a></div></div>
<div class="ttc" id="endrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00210">endrun.c:210</a></div></div>
<div class="ttc" id="structNODE_html"><div class="ttname"><a href="structNODE.html">NODE</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00011">forcetree.h:11</a></div></div>
<div class="ttc" id="forcetree_8c_html_ab3ee27767a982ea77a18f5f4983e4344"><div class="ttname"><a href="forcetree_8c.html#ab3ee27767a982ea77a18f5f4983e4344">inside_node</a></div><div class="ttdeci">static int inside_node(const struct NODE *node, const int p_i)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00186">forcetree.c:186</a></div></div>
<div class="ttc" id="structNODE_html_aa3b4bfc6b6c8c99d88860a5262679487"><div class="ttname"><a href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">NODE::TopLevel</a></div><div class="ttdeci">unsigned int TopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00019">forcetree.h:19</a></div></div>
<div class="ttc" id="structNodeCache_html_a9486e11f8687f7f5797654f117a50c8c"><div class="ttname"><a href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">NodeCache::nnext_thread</a></div><div class="ttdeci">int nnext_thread</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00225">forcetree.c:225</a></div></div>
<div class="ttc" id="structNODE_html_ac63501e2f4f5076dfe3534268e89bc39"><div class="ttname"><a href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">NODE::InternalTopLevel</a></div><div class="ttdeci">unsigned int InternalTopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00018">forcetree.h:18</a></div></div>
<div class="ttc" id="mymalloc_8h_html_a3eb707b32b6ac69f2df085e4bc098cc4"><div class="ttname"><a href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a></div><div class="ttdeci">#define mymalloc(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00012">mymalloc.h:12</a></div></div>
<div class="ttc" id="domain_8c_html_aba985e8ae49746e598c581da7631076e"><div class="ttname"><a href="domain_8c.html#aba985e8ae49746e598c581da7631076e">TopLeaves</a></div><div class="ttdeci">struct topleaf_data * TopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00051">domain.c:51</a></div></div>
<div class="ttc" id="structNodeCache_html"><div class="ttname"><a href="structNodeCache.html">NodeCache</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00224">forcetree.c:224</a></div></div>
<div class="ttc" id="structNODE_html_ae6d6383dc0bc3e1660bbe700b77a85ab"><div class="ttname"><a href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">NODE::len</a></div><div class="ttdeci">MyFloat len</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00013">forcetree.h:13</a></div></div>
<div class="ttc" id="structNODE_html_a9a1b7edbe811165e40220f63a38f2d16"><div class="ttname"><a href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">NODE::father</a></div><div class="ttdeci">int father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00016">forcetree.h:16</a></div></div>
<div class="ttc" id="forcetree_8c_html_a7206eeadd2231b432e8c0932fd23b1e5"><div class="ttname"><a href="forcetree_8c.html#a7206eeadd2231b432e8c0932fd23b1e5">modify_internal_node</a></div><div class="ttdeci">int modify_internal_node(int parent, int subnode, int p_child, int p_toplace, const struct TreeBuilder tb, int *nnext, struct NodeCache *nc, double minlen, int *closepairs)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00247">forcetree.c:247</a></div></div>
<div class="ttc" id="structglobal__data__all__processes_html_ab2e58bf8550b3803c6181390bf536c4e"><div class="ttname"><a href="structglobal__data__all__processes.html#ab2e58bf8550b3803c6181390bf536c4e">global_data_all_processes::TreeNodeMinSize</a></div><div class="ttdeci">double TreeNodeMinSize</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8h_source.html#l00340">allvars.h:340</a></div></div>
<div class="ttc" id="forcetree_8c_html_ad8ee13a12eb949d8554c8d413b684a80"><div class="ttname"><a href="forcetree_8c.html#ad8ee13a12eb949d8554c8d413b684a80">force_create_node_for_topnode</a></div><div class="ttdeci">static void force_create_node_for_topnode(int no, int topnode, int bits, int x, int y, int z, int *nextfree, const int lastnode)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00518">forcetree.c:518</a></div></div>
<div class="ttc" id="structNODE_html_a3460a1b4f9607fe15e6adc40a737d947"><div class="ttname"><a href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">NODE::center</a></div><div class="ttdeci">MyFloat center[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00014">forcetree.h:14</a></div></div>
<div class="ttc" id="structNODE_html_a2a31ed85a69cd67dce1861bd327ac6e9"><div class="ttname"><a href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">NODE::suns</a></div><div class="ttdeci">int suns[8]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00025">forcetree.h:25</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a981968a8f087ebb1f27c385bc5eac7d2"><div class="ttname"><a href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">TreeBuilder::firstnode</a></div><div class="ttdeci">int firstnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00048">forcetree.h:48</a></div></div>
<div class="ttc" id="structglobal__data__all__processes_html_ac1b2e52cf547f5b2fe4bdfb0eaafa22f"><div class="ttname"><a href="structglobal__data__all__processes.html#ac1b2e52cf547f5b2fe4bdfb0eaafa22f">global_data_all_processes::BoxSize</a></div><div class="ttdeci">double BoxSize</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8h_source.html#l00160">allvars.h:160</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="structTreeBuilder_html_a3ab6259028cdd8013165ce13b0a28e4e"><div class="ttname"><a href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">TreeBuilder::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00050">forcetree.h:50</a></div></div>
<div class="ttc" id="forcetree_8c_html_a95095093b87159c1b23a2cb267d9940a"><div class="ttname"><a href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a></div><div class="ttdeci">int get_subnode(const struct NODE *node, const int p_i)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00176">forcetree.c:176</a></div></div>
<div class="ttc" id="endrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00226">endrun.c:226</a></div></div>
<div class="ttc" id="structtopleaf__data_html_ab948aab0a7ca32817caaaec832643645"><div class="ttname"><a href="structtopleaf__data.html#ab948aab0a7ca32817caaaec832643645">topleaf_data::treenode</a></div><div class="ttdeci">int treenode</div><div class="ttdef"><b>Definition:</b> <a href="domain_8h_source.html#l00021">domain.h:21</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a83a6e131b8f124c7f6c8f242893016ce"><div class="ttname"><a href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">TreeBuilder::Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00053">forcetree.h:53</a></div></div>
<div class="ttc" id="allvars_8c_html_ad49123ae0461ffe61629a0d4cf2ba91f"><div class="ttname"><a href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a></div><div class="ttdeci">struct global_data_all_processes All</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8c_source.html#l00047">allvars.c:47</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_ab571f41f30d0859373efe8f65b6523b2_cgraph.svg" width="932" height="462"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_ab571f41f30d0859373efe8f65b6523b2_icgraph.svg" width="1647" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6c833489d009e4b5e850dc5997214775"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c833489d009e4b5e850dc5997214775">&#9670;&nbsp;</a></span>force_tree_eh_slots_fork()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int force_tree_eh_slots_fork </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structEIBase.html">EIBase</a> *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>userdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00079">79</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="slotsmanager_8h_source.html#l00150">EISlotsFork::child</a>, <a class="el" href="forcetree_8c_source.html#l00047">Father</a>, <a class="el" href="forcetree_8c_source.html#l00046">Nextnode</a>, and <a class="el" href="slotsmanager_8h_source.html#l00149">EISlotsFork::parent</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00121">force_tree_build()</a>, and <a class="el" href="forcetree_8c_source.html#l01115">force_tree_free()</a>.</p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;{</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">/* after a fork, we will attach the new particle to the force tree. */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="structEISlotsFork.html">EISlotsFork</a> * ev = (<a class="code" href="structEISlotsFork.html">EISlotsFork</a>*) event;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">int</span> parent = ev-&gt;<a class="code" href="structEISlotsFork.html#adfb224c6cc23cde340474c5d08b5b449">parent</a>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">int</span> child = ev-&gt;<a class="code" href="structEISlotsFork.html#a4651d9a24742b085c3359f4da56cf43c">child</a>;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">int</span> no;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    no = <a class="code" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[parent];</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[parent] = child;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[child] = no;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>[child] = <a class="code" href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>[parent];</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div><div class="ttc" id="forcetree_8c_html_ae1adfde6b271afd077130a64e6b85766"><div class="ttname"><a href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a></div><div class="ttdeci">int * Father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00047">forcetree.c:47</a></div></div>
<div class="ttc" id="structEISlotsFork_html_a4651d9a24742b085c3359f4da56cf43c"><div class="ttname"><a href="structEISlotsFork.html#a4651d9a24742b085c3359f4da56cf43c">EISlotsFork::child</a></div><div class="ttdeci">int child</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00150">slotsmanager.h:150</a></div></div>
<div class="ttc" id="forcetree_8c_html_ad14ab43f541f9c33cb9222ea018c1365"><div class="ttname"><a href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a></div><div class="ttdeci">int * Nextnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00046">forcetree.c:46</a></div></div>
<div class="ttc" id="structEISlotsFork_html_adfb224c6cc23cde340474c5d08b5b449"><div class="ttname"><a href="structEISlotsFork.html#adfb224c6cc23cde340474c5d08b5b449">EISlotsFork::parent</a></div><div class="ttdeci">int parent</div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00149">slotsmanager.h:149</a></div></div>
<div class="ttc" id="structEISlotsFork_html"><div class="ttname"><a href="structEISlotsFork.html">EISlotsFork</a></div><div class="ttdef"><b>Definition:</b> <a href="slotsmanager_8h_source.html#l00147">slotsmanager.h:147</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a6c833489d009e4b5e850dc5997214775_icgraph.svg" width="1602" height="435"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a2ae933e7b7e909142281bae26f95cd00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ae933e7b7e909142281bae26f95cd00">&#9670;&nbsp;</a></span>force_tree_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void force_tree_free </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function frees the memory allocated for the tree, i.e. it frees the space allocated by the function <a class="el" href="forcetree_8c.html#a9c3f496b74e5a0099d41f36e05c2a787">force_treeallocate()</a>. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l01115">1115</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="event_8c_source.html#l00026">event_unlisten()</a>, <a class="el" href="event_8c_source.html#l00054">EventSlotsFork</a>, <a class="el" href="forcetree_8c_source.html#l00047">Father</a>, <a class="el" href="forcetree_8c_source.html#l00079">force_tree_eh_slots_fork()</a>, <a class="el" href="mymalloc_8h_source.html#l00016">myfree</a>, <a class="el" href="forcetree_8c_source.html#l00046">Nextnode</a>, and <a class="el" href="forcetree_8c_source.html#l00049">tree_allocated_flag</a>.</p>

<p class="reference">Referenced by <a class="el" href="gravpm_8c_source.html#l00108">_prepare()</a>, <a class="el" href="domain_8c_source.html#l00133">domain_decompose_full()</a>, <a class="el" href="domain_8c_source.html#l00224">domain_maintain()</a>, <a class="el" href="fof_8c_source.html#l00970">fof_save_groups()</a>, <a class="el" href="forcetree_8c_source.html#l00121">force_tree_build()</a>, and <a class="el" href="forcetree_8c_source.html#l00101">force_tree_rebuild()</a>.</p>
<div class="fragment"><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;{</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <a class="code" href="event_8c.html#a4b5347d345f55b1b454c1eeb02916ca8">event_unlisten</a>(&amp;<a class="code" href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a>, <a class="code" href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a>, NULL);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(<a class="code" href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(<a class="code" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(<a class="code" href="forcetree_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <a class="code" href="forcetree_8c.html#a74c0df66a077bd271e68e460f36d2169">tree_allocated_flag</a> = 0;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;}</div><div class="ttc" id="mymalloc_8h_html_af469c2f7e504a771f5d8a91ac9623240"><div class="ttname"><a href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a></div><div class="ttdeci">#define myfree(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00016">mymalloc.h:16</a></div></div>
<div class="ttc" id="event_8c_html_aafc3f0c1fffb6f0a19f5f3ecd24474c7"><div class="ttname"><a href="event_8c.html#aafc3f0c1fffb6f0a19f5f3ecd24474c7">EventSlotsFork</a></div><div class="ttdeci">EventSpec EventSlotsFork</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00054">event.c:54</a></div></div>
<div class="ttc" id="forcetree_8c_html_a74c0df66a077bd271e68e460f36d2169"><div class="ttname"><a href="forcetree_8c.html#a74c0df66a077bd271e68e460f36d2169">tree_allocated_flag</a></div><div class="ttdeci">static int tree_allocated_flag</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00049">forcetree.c:49</a></div></div>
<div class="ttc" id="forcetree_8c_html_ae1adfde6b271afd077130a64e6b85766"><div class="ttname"><a href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a></div><div class="ttdeci">int * Father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00047">forcetree.c:47</a></div></div>
<div class="ttc" id="forcetree_8c_html_a0cb940c6ac9331805bcc91b437c78e9a"><div class="ttname"><a href="forcetree_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a></div><div class="ttdeci">struct NODE * Nodes_base</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00038">forcetree.c:38</a></div></div>
<div class="ttc" id="forcetree_8c_html_a6c833489d009e4b5e850dc5997214775"><div class="ttname"><a href="forcetree_8c.html#a6c833489d009e4b5e850dc5997214775">force_tree_eh_slots_fork</a></div><div class="ttdeci">static int force_tree_eh_slots_fork(EIBase *event, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00079">forcetree.c:79</a></div></div>
<div class="ttc" id="event_8c_html_a4b5347d345f55b1b454c1eeb02916ca8"><div class="ttname"><a href="event_8c.html#a4b5347d345f55b1b454c1eeb02916ca8">event_unlisten</a></div><div class="ttdeci">int event_unlisten(EventSpec *eh, eventfunc func, void *userdata)</div><div class="ttdef"><b>Definition:</b> <a href="event_8c_source.html#l00026">event.c:26</a></div></div>
<div class="ttc" id="forcetree_8c_html_ad14ab43f541f9c33cb9222ea018c1365"><div class="ttname"><a href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a></div><div class="ttdeci">int * Nextnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00046">forcetree.c:46</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a2ae933e7b7e909142281bae26f95cd00_cgraph.svg" width="334" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a2ae933e7b7e909142281bae26f95cd00_icgraph.svg" width="1388" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a45a1a710bd7d997dbe7cf22a7600b731"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45a1a710bd7d997dbe7cf22a7600b731">&#9670;&nbsp;</a></span>force_tree_rebuild()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void force_tree_rebuild </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00101">101</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="mymalloc_8h_source.html#l00029">AllocatedBytes</a>, <a class="el" href="forcetree_8c_source.html#l00095">force_tree_allocated()</a>, <a class="el" href="forcetree_8c_source.html#l00121">force_tree_build()</a>, <a class="el" href="forcetree_8c_source.html#l01115">force_tree_free()</a>, <a class="el" href="endrun_8c_source.html#l00226">message()</a>, <a class="el" href="partmanager_8h_source.html#l00093">part_manager_type::NumPart</a>, <a class="el" href="partmanager_8c_source.html#l00009">PartManager</a>, and <a class="el" href="walltime_8h_source.html#l00005">walltime_measure</a>.</p>

<p class="reference">Referenced by <a class="el" href="domain_8c_source.html#l00133">domain_decompose_full()</a>, <a class="el" href="domain_8c_source.html#l00224">domain_maintain()</a>, <a class="el" href="fof_8c_source.html#l00970">fof_save_groups()</a>, <a class="el" href="gravpm_8c_source.html#l00071">gravpm_force()</a>, and <a class="el" href="run_8c_source.html#l00038">run()</a>.</p>
<div class="fragment"><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;{</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree construction.  (presently allocated=%g MB)\n&quot;</span>, <a class="code" href="mymalloc_8h.html#a244704ad36fedd917b16cf31b2565e88">AllocatedBytes</a> / (1024.0 * 1024.0));</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#aa1174e5cc4c75944aa98706941a70db9">force_tree_allocated</a>()) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <a class="code" href="forcetree_8c.html#a2ae933e7b7e909142281bae26f95cd00">force_tree_free</a>();</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="forcetree_8c.html#a69350a797a01322b05ec26913d2fa62d">force_tree_build</a>(<a class="code" href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a>-&gt;<a class="code" href="structpart__manager__type.html#ae19becfa10cbd680504de1eb3577cb75">NumPart</a>);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Tree/Build&quot;</span>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Tree construction done.\n&quot;</span>);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div><div class="ttc" id="mymalloc_8h_html_a244704ad36fedd917b16cf31b2565e88"><div class="ttname"><a href="mymalloc_8h.html#a244704ad36fedd917b16cf31b2565e88">AllocatedBytes</a></div><div class="ttdeci">#define AllocatedBytes</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00029">mymalloc.h:29</a></div></div>
<div class="ttc" id="walltime_8h_html_a2d23071e44d020b4a0b3f2876667d370"><div class="ttname"><a href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a></div><div class="ttdeci">#define walltime_measure(name)</div><div class="ttdef"><b>Definition:</b> <a href="walltime_8h_source.html#l00005">walltime.h:5</a></div></div>
<div class="ttc" id="forcetree_8c_html_aa1174e5cc4c75944aa98706941a70db9"><div class="ttname"><a href="forcetree_8c.html#aa1174e5cc4c75944aa98706941a70db9">force_tree_allocated</a></div><div class="ttdeci">int force_tree_allocated()</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00095">forcetree.c:95</a></div></div>
<div class="ttc" id="structpart__manager__type_html_ae19becfa10cbd680504de1eb3577cb75"><div class="ttname"><a href="structpart__manager__type.html#ae19becfa10cbd680504de1eb3577cb75">part_manager_type::NumPart</a></div><div class="ttdeci">int NumPart</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00093">partmanager.h:93</a></div></div>
<div class="ttc" id="forcetree_8c_html_a2ae933e7b7e909142281bae26f95cd00"><div class="ttname"><a href="forcetree_8c.html#a2ae933e7b7e909142281bae26f95cd00">force_tree_free</a></div><div class="ttdeci">void force_tree_free(void)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l01115">forcetree.c:1115</a></div></div>
<div class="ttc" id="endrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00226">endrun.c:226</a></div></div>
<div class="ttc" id="partmanager_8c_html_a6cef44682776e476d8f9f1b9e1f9fe16"><div class="ttname"><a href="partmanager_8c.html#a6cef44682776e476d8f9f1b9e1f9fe16">PartManager</a></div><div class="ttdeci">struct part_manager_type PartManager[1]</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8c_source.html#l00009">partmanager.c:9</a></div></div>
<div class="ttc" id="forcetree_8c_html_a69350a797a01322b05ec26913d2fa62d"><div class="ttname"><a href="forcetree_8c.html#a69350a797a01322b05ec26913d2fa62d">force_tree_build</a></div><div class="ttdeci">static int force_tree_build(int npart)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00121">forcetree.c:121</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a45a1a710bd7d997dbe7cf22a7600b731_cgraph.svg" width="1984" height="1316"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a45a1a710bd7d997dbe7cf22a7600b731_icgraph.svg" width="1068" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a9c3f496b74e5a0099d41f36e05c2a787"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c3f496b74e5a0099d41f36e05c2a787">&#9670;&nbsp;</a></span>force_treeallocate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a> force_treeallocate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxnodes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxpart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>first_node_offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function allocates the memory used for storage of the tree and of auxiliary arrays needed for tree-walk and link-lists. Usually, maxnodes approximately equal to 0.7*maxpart is sufficient to store the tree for up to maxpart particles. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l01086">1086</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="mymalloc_8h_source.html#l00029">AllocatedBytes</a>, <a class="el" href="forcetree_8c_source.html#l00047">Father</a>, <a class="el" href="forcetree_8h_source.html#l00048">TreeBuilder::firstnode</a>, <a class="el" href="forcetree_8h_source.html#l00050">TreeBuilder::lastnode</a>, <a class="el" href="forcetree_8c_source.html#l00042">MaxNodes</a>, <a class="el" href="endrun_8c_source.html#l00226">message()</a>, <a class="el" href="mymalloc_8h_source.html#l00012">mymalloc</a>, <a class="el" href="forcetree_8c_source.html#l00046">Nextnode</a>, <a class="el" href="forcetree_8h_source.html#l00053">TreeBuilder::Nodes</a>, <a class="el" href="domain_8c_source.html#l00055">NTopNodes</a>, <a class="el" href="forcetree_8c_source.html#l00043">RootNode</a>, and <a class="el" href="forcetree_8c_source.html#l00049">tree_allocated_flag</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00121">force_tree_build()</a>.</p>
<div class="fragment"><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;{</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordtype">size_t</span> bytes;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordtype">size_t</span> allbytes = 0;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keyword">struct </span><a class="code" href="structTreeBuilder.html">TreeBuilder</a> tb;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <a class="code" href="forcetree_8c.html#a74c0df66a077bd271e68e460f36d2169">tree_allocated_flag</a> = 1;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <a class="code" href="forcetree_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a> = maxnodes;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <a class="code" href="forcetree_8c.html#a864c54aa65cc3be72a6ee67e77d4324a">RootNode</a> = first_node_offset;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Allocating memory for %d tree-nodes (MaxPart=%d).\n&quot;</span>, maxnodes, maxpart);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <a class="code" href="forcetree_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a> = (<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;Nodes_base&quot;</span>, bytes = (<a class="code" href="forcetree_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a> + 1) * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a>));</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    allbytes += bytes;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a> = <a class="code" href="forcetree_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a> - first_node_offset;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    tb.firstnode = first_node_offset;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    tb.lastnode = first_node_offset + maxnodes;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    tb.Nodes = <a class="code" href="forcetree_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a> - first_node_offset;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <a class="code" href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a> = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;Nextnode&quot;</span>, bytes = (maxpart + <a class="code" href="domain_8c.html#a9e9f84aad826ef9cbb960944e88efd6b">NTopNodes</a>) * <span class="keyword">sizeof</span>(int));</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    allbytes += bytes;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <a class="code" href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a> = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;Father&quot;</span>, bytes = (maxpart) * <span class="keyword">sizeof</span>(int));</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    allbytes += bytes;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Allocated %g MByte for BH-tree, (presently allocated %g MB)\n&quot;</span>,</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;         allbytes / (1024.0 * 1024.0),</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;         <a class="code" href="mymalloc_8h.html#a244704ad36fedd917b16cf31b2565e88">AllocatedBytes</a> / (1024.0 * 1024.0));</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordflow">return</span> tb;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;}</div><div class="ttc" id="forcetree_8c_html_a74c0df66a077bd271e68e460f36d2169"><div class="ttname"><a href="forcetree_8c.html#a74c0df66a077bd271e68e460f36d2169">tree_allocated_flag</a></div><div class="ttdeci">static int tree_allocated_flag</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00049">forcetree.c:49</a></div></div>
<div class="ttc" id="structNODE_html"><div class="ttname"><a href="structNODE.html">NODE</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00011">forcetree.h:11</a></div></div>
<div class="ttc" id="mymalloc_8h_html_a244704ad36fedd917b16cf31b2565e88"><div class="ttname"><a href="mymalloc_8h.html#a244704ad36fedd917b16cf31b2565e88">AllocatedBytes</a></div><div class="ttdeci">#define AllocatedBytes</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00029">mymalloc.h:29</a></div></div>
<div class="ttc" id="forcetree_8c_html_ae1adfde6b271afd077130a64e6b85766"><div class="ttname"><a href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a></div><div class="ttdeci">int * Father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00047">forcetree.c:47</a></div></div>
<div class="ttc" id="forcetree_8c_html_a0cb940c6ac9331805bcc91b437c78e9a"><div class="ttname"><a href="forcetree_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a></div><div class="ttdeci">struct NODE * Nodes_base</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00038">forcetree.c:38</a></div></div>
<div class="ttc" id="mymalloc_8h_html_a3eb707b32b6ac69f2df085e4bc098cc4"><div class="ttname"><a href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a></div><div class="ttdeci">#define mymalloc(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00012">mymalloc.h:12</a></div></div>
<div class="ttc" id="forcetree_8c_html_ad14ab43f541f9c33cb9222ea018c1365"><div class="ttname"><a href="forcetree_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a></div><div class="ttdeci">int * Nextnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00046">forcetree.c:46</a></div></div>
<div class="ttc" id="forcetree_8c_html_ac46f89ba3715dfa877c2e1b8822da657"><div class="ttname"><a href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00038">forcetree.c:38</a></div></div>
<div class="ttc" id="forcetree_8c_html_a864c54aa65cc3be72a6ee67e77d4324a"><div class="ttname"><a href="forcetree_8c.html#a864c54aa65cc3be72a6ee67e77d4324a">RootNode</a></div><div class="ttdeci">int RootNode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00043">forcetree.c:43</a></div></div>
<div class="ttc" id="endrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00226">endrun.c:226</a></div></div>
<div class="ttc" id="forcetree_8c_html_aca70a1751175167a36c1c6775a338bee"><div class="ttname"><a href="forcetree_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a></div><div class="ttdeci">int MaxNodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00042">forcetree.c:42</a></div></div>
<div class="ttc" id="domain_8c_html_a9e9f84aad826ef9cbb960944e88efd6b"><div class="ttname"><a href="domain_8c.html#a9e9f84aad826ef9cbb960944e88efd6b">NTopNodes</a></div><div class="ttdeci">int NTopNodes</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00055">domain.c:55</a></div></div>
<div class="ttc" id="structTreeBuilder_html"><div class="ttname"><a href="structTreeBuilder.html">TreeBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00046">forcetree.h:46</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a9c3f496b74e5a0099d41f36e05c2a787_cgraph.svg" width="555" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a9c3f496b74e5a0099d41f36e05c2a787_icgraph.svg" width="1404" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4b2e6ceda1e6b5ca4469148b13bff5dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b2e6ceda1e6b5ca4469148b13bff5dc">&#9670;&nbsp;</a></span>force_treeupdate_pseudos()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void force_treeupdate_pseudos </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td>
          <td class="paramname"><em>tb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This function updates the top-level tree after the multipole moments of the pseudo-particles have been updated. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00902">902</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00014">NODE::center</a>, <a class="el" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a>, <a class="el" href="endrun_8c_source.html#l00210">endrun()</a>, <a class="el" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a>, <a class="el" href="forcetree_8h_source.html#l00048">TreeBuilder::firstnode</a>, <a class="el" href="forcetree_8c_source.html#l00649">force_adjust_node_softening()</a>, <a class="el" href="forcetree_8h_source.html#l00018">NODE::InternalTopLevel</a>, <a class="el" href="forcetree_8h_source.html#l00050">TreeBuilder::lastnode</a>, <a class="el" href="forcetree_8h_source.html#l00021">NODE::MixedSofteningsInNode</a>, <a class="el" href="auxiliary__functions_8c_source.html#l00014">s</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00121">force_tree_build()</a>.</p>
<div class="fragment"><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;{</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordtype">int</span> j, p;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> <a class="code" href="auxiliary__functions_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a>[3], <a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    mass = 0;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    s[0] = 0;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    s[1] = 0;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    s[2] = 0;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    hmax = 0;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.MaxSoftening = -1;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">MixedSofteningsInNode</a> = 0;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    p = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.nextnode;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="comment">/* since we are dealing with top-level nodes, we know that there are 8 consecutive daughter nodes */</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 8; j++)</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    {</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="comment">/*This may not happen as we are an internal top level node*/</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keywordflow">if</span>(p &lt; tb.firstnode || p &gt;= tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>)</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(6767, <span class="stringliteral">&quot;Updating pseudos: %d -&gt; %d which is not an internal node between %d and %d.&quot;</span>,no, p, tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>, tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.InternalTopLevel)</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            <a class="code" href="forcetree_8c.html#a4b2e6ceda1e6b5ca4469148b13bff5dc">force_treeupdate_pseudos</a>(p, tb);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        mass += (<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        s[0] += (<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass * <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[0]);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        s[1] += (<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass * <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[1]);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        s[2] += (<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass * <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[2]);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.d.hmax &gt; hmax)</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            hmax = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <a class="code" href="forcetree_8c.html#a756a7b1f862dd81ef83e1f6c00f8ebb2">force_adjust_node_softening</a>(&amp;<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no], <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.d.MaxSoftening, <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">MixedSofteningsInNode</a>);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        p = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.sibling;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">if</span>(mass)</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    {</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        s[0] /= <a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        s[1] /= <a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        s[2] /= <a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    }</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    {</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        s[0] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[0];</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        s[1] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[1];</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        s[2] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[2];</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    }</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[0] = s[0];</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[1] = s[1];</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[2] = s[2];</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass = <a class="code" href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">mass</a>;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax = <a class="code" href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">hmax</a>;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;}</div><div class="ttc" id="structNODE_html_a5f599abbea1f0fc03e09d98232c740a8"><div class="ttname"><a href="structNODE.html#a5f599abbea1f0fc03e09d98232c740a8">NODE::mass</a></div><div class="ttdeci">MyFloat mass</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00029">forcetree.h:29</a></div></div>
<div class="ttc" id="structNODE_html_a721d8801f7caf356aaab78a822a56640"><div class="ttname"><a href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a></div><div class="ttdeci">struct NODE::@10 f</div></div>
<div class="ttc" id="endrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00210">endrun.c:210</a></div></div>
<div class="ttc" id="structNODE_html_a7f339ed4a80e4bc82506fdab65a7d655"><div class="ttname"><a href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a></div><div class="ttdeci">struct NODE::@11::@12 d</div></div>
<div class="ttc" id="structNODE_html_a98a1b123b3faa9414fc9a82a5556951c"><div class="ttname"><a href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">NODE::MixedSofteningsInNode</a></div><div class="ttdeci">unsigned int MixedSofteningsInNode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00021">forcetree.h:21</a></div></div>
<div class="ttc" id="forcetree_8c_html_a4b2e6ceda1e6b5ca4469148b13bff5dc"><div class="ttname"><a href="forcetree_8c.html#a4b2e6ceda1e6b5ca4469148b13bff5dc">force_treeupdate_pseudos</a></div><div class="ttdeci">static void force_treeupdate_pseudos(int no, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00902">forcetree.c:902</a></div></div>
<div class="ttc" id="structNODE_html_a99422a4018ea66f6dbc395d9a7babd70"><div class="ttname"><a href="structNODE.html#a99422a4018ea66f6dbc395d9a7babd70">NODE::hmax</a></div><div class="ttdeci">MyFloat hmax</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00032">forcetree.h:32</a></div></div>
<div class="ttc" id="auxiliary__functions_8c_html_ac9562ee4ecb3b8aeebeb04656e7e57a9"><div class="ttname"><a href="auxiliary__functions_8c.html#ac9562ee4ecb3b8aeebeb04656e7e57a9">s</a></div><div class="ttdeci">#define s</div><div class="ttdef"><b>Definition:</b> <a href="auxiliary__functions_8c_source.html#l00014">auxiliary_functions.c:14</a></div></div>
<div class="ttc" id="forcetree_8c_html_a756a7b1f862dd81ef83e1f6c00f8ebb2"><div class="ttname"><a href="forcetree_8c.html#a756a7b1f862dd81ef83e1f6c00f8ebb2">force_adjust_node_softening</a></div><div class="ttdeci">static void force_adjust_node_softening(struct NODE *pnode, double MaxSoftening, int mixed)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00649">forcetree.c:649</a></div></div>
<div class="ttc" id="structNODE_html_a3460a1b4f9607fe15e6adc40a737d947"><div class="ttname"><a href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">NODE::center</a></div><div class="ttdeci">MyFloat center[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00014">forcetree.h:14</a></div></div>
<div class="ttc" id="forcetree_8c_html_ac46f89ba3715dfa877c2e1b8822da657"><div class="ttname"><a href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00038">forcetree.c:38</a></div></div>
<div class="ttc" id="types_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00022">types.h:22</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a981968a8f087ebb1f27c385bc5eac7d2"><div class="ttname"><a href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">TreeBuilder::firstnode</a></div><div class="ttdeci">int firstnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00048">forcetree.h:48</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="structTreeBuilder_html_a3ab6259028cdd8013165ce13b0a28e4e"><div class="ttname"><a href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">TreeBuilder::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00050">forcetree.h:50</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a4b2e6ceda1e6b5ca4469148b13bff5dc_cgraph.svg" width="718" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a4b2e6ceda1e6b5ca4469148b13bff5dc_icgraph.svg" width="1454" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab3aecab620a37299d10b8013a4db5611"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3aecab620a37299d10b8013a4db5611">&#9670;&nbsp;</a></span>force_update_hmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void force_update_hmax </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>activeset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function updates the hmax-values in tree nodes that hold SPH particles. These values are needed to find all neighbors in the hydro-force computation. Since the Hsml-values are potentially changed in the SPH-density computation, <a class="el" href="forcetree_8c.html#ab3aecab620a37299d10b8013a4db5611">force_update_hmax()</a> should be carried out just before the hydrodynamical SPH forces are computed, i.e. after <a class="el" href="density_8c.html#ad86cdeb9e3bfbe9af379ac9f7daf194c">density()</a>. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00970">970</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a>, <a class="el" href="forcetree_8h_source.html#l00020">NODE::DependsOnLocalMass</a>, <a class="el" href="forcetree_8h_source.html#l00016">NODE::father</a>, <a class="el" href="forcetree_8c_source.html#l00047">Father</a>, <a class="el" href="forcetree_8c_source.html#l00042">MaxNodes</a>, <a class="el" href="endrun_8c_source.html#l00226">message()</a>, <a class="el" href="mymalloc_8h_source.html#l00016">myfree</a>, <a class="el" href="mymalloc_8h_source.html#l00012">mymalloc</a>, <a class="el" href="allvars_8c_source.html#l00025">NTask</a>, <a class="el" href="domain_8c_source.html#l00055">NTopLeaves</a>, <a class="el" href="partmanager_8h_source.html#l00099">P</a>, <a class="el" href="forcetree_8c_source.html#l00043">RootNode</a>, <a class="el" href="make__zeros_8py_source.html#l00006">make_zeros::size</a>, <a class="el" href="allvars_8c_source.html#l00024">ThisTask</a>, <a class="el" href="forcetree_8h_source.html#l00019">NODE::TopLevel</a>, <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>, and <a class="el" href="walltime_8h_source.html#l00005">walltime_measure</a>.</p>

<p class="reference">Referenced by <a class="el" href="run_8c_source.html#l00190">compute_accelerations()</a>.</p>
<div class="fragment"><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;{</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordtype">int</span> i, ta; </div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordtype">int</span> *counts, *offsets;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keyword">struct </span>dirty_node_data {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="keywordtype">int</span> treenode;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> hmax;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    } * DirtyTopLevelNodes;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordtype">int</span> NumDirtyTopLevelNodes;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Misc&quot;</span>);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    NumDirtyTopLevelNodes = 0;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">/* At most NTopLeaves are dirty, since we are only concerned with TOPLEVEL nodes */</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    DirtyTopLevelNodes = (<span class="keyword">struct </span>dirty_node_data*) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;DirtyTopLevelNodes&quot;</span>, <a class="code" href="domain_8c.html#a1c853817a113e66c3d16ad1216733919">NTopLeaves</a> * <span class="keyword">sizeof</span>(DirtyTopLevelNodes[0]));</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">/* FIXME: This can be made a struct flag*/</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordtype">char</span> * NodeIsDirty = (<span class="keywordtype">char</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;NodeIsDirty&quot;</span>, <a class="code" href="forcetree_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="comment">/* FIXME: actually only TOPLEVEL nodes contains the local mass can potentially be dirty,</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">     *  we may want to save a list of them to speed this up.</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment">     * */</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="forcetree_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a>; i ++) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        NodeIsDirty[i] = 0;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    }</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="namespacemake__zeros.html#a5a378c460c2a12be3a58ac2e687852d9">size</a>; i++)</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p_i = activeset[i];</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Type != 0)</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordtype">int</span> no = <a class="code" href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>[p_i];</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordflow">while</span>(no &gt;= 0)</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        {</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Hsml &lt;= <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].u.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax) <span class="keywordflow">break</span>;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax = <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Hsml;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].f.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a>) <span class="comment">/* we reached a top-level node */</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            {</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                <span class="keywordflow">if</span> (!NodeIsDirty[no - <a class="code" href="forcetree_8c.html#a864c54aa65cc3be72a6ee67e77d4324a">RootNode</a>]) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                    NodeIsDirty[no - <a class="code" href="forcetree_8c.html#a864c54aa65cc3be72a6ee67e77d4324a">RootNode</a>] = 1;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                    DirtyTopLevelNodes[NumDirtyTopLevelNodes].treenode = no;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                    DirtyTopLevelNodes[NumDirtyTopLevelNodes].hmax = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                    NumDirtyTopLevelNodes ++;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                }</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            }</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;            no = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        }</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    }</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="comment">/* share the hmax-data of the dirty nodes accross CPUs */</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    counts = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;counts&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    offsets = (<span class="keywordtype">int</span> *) <a class="code" href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a>(<span class="stringliteral">&quot;offsets&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * (<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> + 1));</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    MPI_Allgather(&amp;NumDirtyTopLevelNodes, 1, MPI_INT, counts, 1, MPI_INT, MPI_COMM_WORLD);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">for</span>(ta = 0, offsets[0] = 0; ta &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; ta++)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    {</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        offsets[ta + 1] = offsets[ta] + counts[ta];</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <a class="code" href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a>(0, <span class="stringliteral">&quot;Hmax exchange: %d toplevel tree nodes out of %d\n&quot;</span>, offsets[NTask], <a class="code" href="domain_8c.html#a1c853817a113e66c3d16ad1216733919">NTopLeaves</a>);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="comment">/* move to the right place for MPI_INPLACE*/</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    memmove(&amp;DirtyTopLevelNodes[offsets[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>]], &amp;DirtyTopLevelNodes[0], NumDirtyTopLevelNodes * <span class="keyword">sizeof</span>(DirtyTopLevelNodes[0]));</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    MPI_Datatype MPI_TYPE_DIRTY_NODES;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    MPI_Type_contiguous(<span class="keyword">sizeof</span>(DirtyTopLevelNodes[0]), MPI_BYTE, &amp;MPI_TYPE_DIRTY_NODES);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    MPI_Type_commit(&amp;MPI_TYPE_DIRTY_NODES);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    MPI_Allgatherv(MPI_IN_PLACE, 0, MPI_DATATYPE_NULL,</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            DirtyTopLevelNodes, counts, offsets, MPI_TYPE_DIRTY_NODES, MPI_COMM_WORLD);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    MPI_Type_free(&amp;MPI_TYPE_DIRTY_NODES);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; offsets[<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>]; i++)</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="keywordtype">int</span> no = DirtyTopLevelNodes[i].treenode;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="comment">/* FIXME: why does this matter? The logic is simpler if we just blindly update them all.</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">            ::: to avoid that the hmax is updated twice :::*/</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].f.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a>)</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;            no = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="keywordflow">while</span>(no &gt;= 0)</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            <span class="keywordflow">if</span>(DirtyTopLevelNodes[i].hmax &lt;= <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].u.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax) <span class="keywordflow">break</span>;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax = DirtyTopLevelNodes[i].hmax;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            no = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a>;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        }</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(offsets);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(counts);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(NodeIsDirty);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <a class="code" href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a>(DirtyTopLevelNodes);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a>(<span class="stringliteral">&quot;/Tree/HmaxUpdate&quot;</span>);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;}</div><div class="ttc" id="mymalloc_8h_html_af469c2f7e504a771f5d8a91ac9623240"><div class="ttname"><a href="mymalloc_8h.html#af469c2f7e504a771f5d8a91ac9623240">myfree</a></div><div class="ttdeci">#define myfree(x)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00016">mymalloc.h:16</a></div></div>
<div class="ttc" id="partmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00099">partmanager.h:99</a></div></div>
<div class="ttc" id="domain_8c_html_a1c853817a113e66c3d16ad1216733919"><div class="ttname"><a href="domain_8c.html#a1c853817a113e66c3d16ad1216733919">NTopLeaves</a></div><div class="ttdeci">int NTopLeaves</div><div class="ttdef"><b>Definition:</b> <a href="domain_8c_source.html#l00055">domain.c:55</a></div></div>
<div class="ttc" id="walltime_8h_html_a2d23071e44d020b4a0b3f2876667d370"><div class="ttname"><a href="walltime_8h.html#a2d23071e44d020b4a0b3f2876667d370">walltime_measure</a></div><div class="ttdeci">#define walltime_measure(name)</div><div class="ttdef"><b>Definition:</b> <a href="walltime_8h_source.html#l00005">walltime.h:5</a></div></div>
<div class="ttc" id="structNODE_html_aa3b4bfc6b6c8c99d88860a5262679487"><div class="ttname"><a href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">NODE::TopLevel</a></div><div class="ttdeci">unsigned int TopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00019">forcetree.h:19</a></div></div>
<div class="ttc" id="forcetree_8c_html_ae1adfde6b271afd077130a64e6b85766"><div class="ttname"><a href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a></div><div class="ttdeci">int * Father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00047">forcetree.c:47</a></div></div>
<div class="ttc" id="structNODE_html_a7f339ed4a80e4bc82506fdab65a7d655"><div class="ttname"><a href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a></div><div class="ttdeci">struct NODE::@11::@12 d</div></div>
<div class="ttc" id="structNODE_html_a1ff8c5e570722798d188c60455312fa2"><div class="ttname"><a href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">NODE::DependsOnLocalMass</a></div><div class="ttdeci">unsigned int DependsOnLocalMass</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00020">forcetree.h:20</a></div></div>
<div class="ttc" id="allvars_8c_html_a675acdcd149f5993271a1fdc11673b65"><div class="ttname"><a href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a></div><div class="ttdeci">int NTask</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8c_source.html#l00025">allvars.c:25</a></div></div>
<div class="ttc" id="allvars_8c_html_a52c8c7d2abff436111942e02c5bb466a"><div class="ttname"><a href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a></div><div class="ttdeci">int ThisTask</div><div class="ttdef"><b>Definition:</b> <a href="allvars_8c_source.html#l00024">allvars.c:24</a></div></div>
<div class="ttc" id="mymalloc_8h_html_a3eb707b32b6ac69f2df085e4bc098cc4"><div class="ttname"><a href="mymalloc_8h.html#a3eb707b32b6ac69f2df085e4bc098cc4">mymalloc</a></div><div class="ttdeci">#define mymalloc(name, size)</div><div class="ttdef"><b>Definition:</b> <a href="mymalloc_8h_source.html#l00012">mymalloc.h:12</a></div></div>
<div class="ttc" id="namespacemake__zeros_html_a5a378c460c2a12be3a58ac2e687852d9"><div class="ttname"><a href="namespacemake__zeros.html#a5a378c460c2a12be3a58ac2e687852d9">make_zeros.size</a></div><div class="ttdeci">size</div><div class="ttdef"><b>Definition:</b> <a href="make__zeros_8py_source.html#l00006">make_zeros.py:6</a></div></div>
<div class="ttc" id="structNODE_html_a9a1b7edbe811165e40220f63a38f2d16"><div class="ttname"><a href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">NODE::father</a></div><div class="ttdeci">int father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00016">forcetree.h:16</a></div></div>
<div class="ttc" id="forcetree_8c_html_ac46f89ba3715dfa877c2e1b8822da657"><div class="ttname"><a href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00038">forcetree.c:38</a></div></div>
<div class="ttc" id="types_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00022">types.h:22</a></div></div>
<div class="ttc" id="forcetree_8c_html_a864c54aa65cc3be72a6ee67e77d4324a"><div class="ttname"><a href="forcetree_8c.html#a864c54aa65cc3be72a6ee67e77d4324a">RootNode</a></div><div class="ttdeci">int RootNode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00043">forcetree.c:43</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="endrun_8c_html_a6567cd867c5549fb6586e19ccd819764"><div class="ttname"><a href="endrun_8c.html#a6567cd867c5549fb6586e19ccd819764">message</a></div><div class="ttdeci">void message(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00226">endrun.c:226</a></div></div>
<div class="ttc" id="forcetree_8c_html_aca70a1751175167a36c1c6775a338bee"><div class="ttname"><a href="forcetree_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a></div><div class="ttdeci">int MaxNodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00042">forcetree.c:42</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_ab3aecab620a37299d10b8013a4db5611_cgraph.svg" width="566" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_ab3aecab620a37299d10b8013a4db5611_icgraph.svg" width="847" height="63"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a079d4156d4368c439545f14fcf81878f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a079d4156d4368c439545f14fcf81878f">&#9670;&nbsp;</a></span>force_update_node_recursive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int force_update_node_recursive </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sib</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tail</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td>
          <td class="paramname"><em>tb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>this routine determines the multipole moments for a given internal node and all its subnodes using a recursive computation. The result is stored in the Nodes[] structure in the sequence of this tree-walk.</p>
<p>Note that the bitflags-struct for each node is used to store in the lowest bits some special information: Bit 0 flags whether the node belongs to the top-level tree corresponding to the domain decomposition, while Bit 1 signals whether the top-level node is dependent on local mass.</p>
<p>bits 2-4 give the particle type with the maximum softening among the particles in the node, and bit 5 flags whether the node contains any particles with lower softening than that.</p>
<p>The function also concatenates the NextNode linked lists. The return value and argument tail is the current tail of the NextNode linked list. </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00707">707</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8c_source.html#l00667">add_particle_moment_to_node()</a>, <a class="el" href="forcetree_8h_source.html#l00014">NODE::center</a>, <a class="el" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a>, <a class="el" href="forcetree_8h_source.html#l00020">NODE::DependsOnLocalMass</a>, <a class="el" href="endrun_8c_source.html#l00210">endrun()</a>, <a class="el" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a>, <a class="el" href="forcetree_8h_source.html#l00048">TreeBuilder::firstnode</a>, <a class="el" href="forcetree_8c_source.html#l00649">force_adjust_node_softening()</a>, <a class="el" href="forcetree_8c_source.html#l00590">force_get_next_node()</a>, <a class="el" href="forcetree_8c_source.html#l00607">force_set_next_node()</a>, <a class="el" href="forcetree_8h_source.html#l00050">TreeBuilder::lastnode</a>, <a class="el" href="forcetree_8h_source.html#l00021">NODE::MixedSofteningsInNode</a>, <a class="el" href="forcetree_8h_source.html#l00025">NODE::suns</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00490">force_tree_build_single()</a>.</p>
<div class="fragment"><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;{</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="comment">/*Set NextNode for this node*/</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">if</span>(tail &lt; tb.firstnode &amp;&amp; tail &gt;= 0 &amp;&amp; <a class="code" href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a>(tail, tb) != -1) {</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <a class="code" href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a>(2,<span class="stringliteral">&quot;Particle %d with tail %d already has tail set: %d\n&quot;</span>,no, tail, <a class="code" href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a>(tail, tb));</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    tail = <a class="code" href="forcetree_8c.html#a8571da12c389bfcf10555865a0e3882d">force_set_next_node</a>(tail, no, tb);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">/* For particles and pseudo particles we have nothing to update; */</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">/* But the new tail is the last particle in the linked list. */</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span>(no &lt; tb.firstnode || no &gt;= tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordtype">int</span> next = no;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">while</span>(next != -1) {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            no = next;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            next = <a class="code" href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a>(next, tb);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        }</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">return</span> no;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    }</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordtype">int</span> j, suns[8];</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">/* this &quot;backup&quot; is necessary because the nextnode</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">     * entry will overwrite one element (union!) */</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 8; j++)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        suns[j] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].u.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[j];</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    memset(&amp;<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].u.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s,0,3*<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a>));</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass = 0;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax = 0;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.MaxSoftening = -1;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">DependsOnLocalMass</a> = 0;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">MixedSofteningsInNode</a> = 0;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 8; j++)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keywordtype">int</span> nextsib = sib;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p = suns[j];</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordtype">int</span> jj;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="comment">/*Empty slot*/</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">if</span>(p &lt; 0)</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="comment">/* check if we have a sibling on the same level */</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">for</span>(jj = j + 1; jj &lt; 8; jj++)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <span class="keywordflow">if</span>(suns[jj] &gt;= 0) {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                nextsib = suns[jj];</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            }</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        tail = <a class="code" href="forcetree_8c.html#a079d4156d4368c439545f14fcf81878f">force_update_node_recursive</a>(p, nextsib, tail, tb);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">if</span>(p &gt;= tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>)    <span class="comment">/* a pseudo particle */</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="comment">/* nothing to be done here because the mass of the</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">             * pseudo-particle is still zero. The node attributes will be changed</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">             * later when we exchange the pseudo-particles.</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        }</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p &lt; tb.lastnode &amp;&amp; p &gt;= tb.<a class="code" href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">firstnode</a>) <span class="comment">/* a tree node */</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        {</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass += (<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[0] += (<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass * <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[0]);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[1] += (<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass * <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[1]);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[2] += (<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass * <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[2]);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].u.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax &gt; <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.hmax;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            <a class="code" href="forcetree_8c.html#a756a7b1f862dd81ef83e1f6c00f8ebb2">force_adjust_node_softening</a>(&amp;<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no], <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].u.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.MaxSoftening, <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[p].<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">MixedSofteningsInNode</a>);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">else</span> <span class="comment">/* a list of particles */</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <span class="comment">/* add all particles in this tree-node */</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keywordtype">int</span> next = p;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="keywordflow">while</span>(next != -1) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                <a class="code" href="forcetree_8c.html#a569cd386bf7d67968fad6344898cb70c">add_particle_moment_to_node</a>(&amp;<a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no], next);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                next = <a class="code" href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a>(next, tb);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        }</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    }</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> mass = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.mass;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordflow">if</span>(mass)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[0] /= mass;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[1] /= mass;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[2] /= mass;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="comment">/*This only happens for a pseudo particle*/</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[0] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[0];</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[1] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[1];</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.s[2] = <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[2];</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <a class="code" href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">d</a>.sibling = sib;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">return</span> tail;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;}</div><div class="ttc" id="structNODE_html_a721d8801f7caf356aaab78a822a56640"><div class="ttname"><a href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a></div><div class="ttdeci">struct NODE::@10 f</div></div>
<div class="ttc" id="endrun_8c_html_ad963d7efdb9f10f7a2298c8ccd222ab0"><div class="ttname"><a href="endrun_8c.html#ad963d7efdb9f10f7a2298c8ccd222ab0">endrun</a></div><div class="ttdeci">void endrun(int where, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="endrun_8c_source.html#l00210">endrun.c:210</a></div></div>
<div class="ttc" id="structNODE_html_a7f339ed4a80e4bc82506fdab65a7d655"><div class="ttname"><a href="structNODE.html#a7f339ed4a80e4bc82506fdab65a7d655">NODE::d</a></div><div class="ttdeci">struct NODE::@11::@12 d</div></div>
<div class="ttc" id="structNODE_html_a98a1b123b3faa9414fc9a82a5556951c"><div class="ttname"><a href="structNODE.html#a98a1b123b3faa9414fc9a82a5556951c">NODE::MixedSofteningsInNode</a></div><div class="ttdeci">unsigned int MixedSofteningsInNode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00021">forcetree.h:21</a></div></div>
<div class="ttc" id="forcetree_8c_html_a8571da12c389bfcf10555865a0e3882d"><div class="ttname"><a href="forcetree_8c.html#a8571da12c389bfcf10555865a0e3882d">force_set_next_node</a></div><div class="ttdeci">int force_set_next_node(int no, int next, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00607">forcetree.c:607</a></div></div>
<div class="ttc" id="structNODE_html_a1ff8c5e570722798d188c60455312fa2"><div class="ttname"><a href="structNODE.html#a1ff8c5e570722798d188c60455312fa2">NODE::DependsOnLocalMass</a></div><div class="ttdeci">unsigned int DependsOnLocalMass</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00020">forcetree.h:20</a></div></div>
<div class="ttc" id="forcetree_8c_html_a756a7b1f862dd81ef83e1f6c00f8ebb2"><div class="ttname"><a href="forcetree_8c.html#a756a7b1f862dd81ef83e1f6c00f8ebb2">force_adjust_node_softening</a></div><div class="ttdeci">static void force_adjust_node_softening(struct NODE *pnode, double MaxSoftening, int mixed)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00649">forcetree.c:649</a></div></div>
<div class="ttc" id="structNODE_html_a3460a1b4f9607fe15e6adc40a737d947"><div class="ttname"><a href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">NODE::center</a></div><div class="ttdeci">MyFloat center[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00014">forcetree.h:14</a></div></div>
<div class="ttc" id="forcetree_8c_html_ac46f89ba3715dfa877c2e1b8822da657"><div class="ttname"><a href="forcetree_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00038">forcetree.c:38</a></div></div>
<div class="ttc" id="types_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00022">types.h:22</a></div></div>
<div class="ttc" id="structNODE_html_a2a31ed85a69cd67dce1861bd327ac6e9"><div class="ttname"><a href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">NODE::suns</a></div><div class="ttdeci">int suns[8]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00025">forcetree.h:25</a></div></div>
<div class="ttc" id="forcetree_8c_html_a96d9883368c2630c024e1196e849f07c"><div class="ttname"><a href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a></div><div class="ttdeci">int force_get_next_node(int no, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00590">forcetree.c:590</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a981968a8f087ebb1f27c385bc5eac7d2"><div class="ttname"><a href="structTreeBuilder.html#a981968a8f087ebb1f27c385bc5eac7d2">TreeBuilder::firstnode</a></div><div class="ttdeci">int firstnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00048">forcetree.h:48</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="structTreeBuilder_html_a3ab6259028cdd8013165ce13b0a28e4e"><div class="ttname"><a href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">TreeBuilder::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00050">forcetree.h:50</a></div></div>
<div class="ttc" id="forcetree_8c_html_a569cd386bf7d67968fad6344898cb70c"><div class="ttname"><a href="forcetree_8c.html#a569cd386bf7d67968fad6344898cb70c">add_particle_moment_to_node</a></div><div class="ttdeci">static void add_particle_moment_to_node(struct NODE *pnode, int i)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00667">forcetree.c:667</a></div></div>
<div class="ttc" id="forcetree_8c_html_a079d4156d4368c439545f14fcf81878f"><div class="ttname"><a href="forcetree_8c.html#a079d4156d4368c439545f14fcf81878f">force_update_node_recursive</a></div><div class="ttdeci">int force_update_node_recursive(int no, int sib, int tail, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00707">forcetree.c:707</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a079d4156d4368c439545f14fcf81878f_cgraph.svg" width="799" height="252"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a079d4156d4368c439545f14fcf81878f_icgraph.svg" width="1674" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6710cf447fc53308c513b002cf446ebf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6710cf447fc53308c513b002cf446ebf">&#9670;&nbsp;</a></span>get_freenode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_freenode </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nnext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structNodeCache.html">NodeCache</a> *&#160;</td>
          <td class="paramname"><em>nc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00231">231</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="system_8h_source.html#l00044">atomic_fetch_and_add()</a>, <a class="el" href="forcetree_8c_source.html#l00225">NodeCache::nnext_thread</a>, <a class="el" href="forcetree_8c_source.html#l00221">NODECACHE_SIZE</a>, and <a class="el" href="forcetree_8c_source.html#l00226">NodeCache::nrem_thread</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00247">modify_internal_node()</a>.</p>
<div class="fragment"><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">/*Get memory for an extra node from our cache.*/</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">if</span>(nc-&gt;<a class="code" href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">nrem_thread</a> == 0) {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        nc-&gt;<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> = <a class="code" href="system_8h.html#a00eeba7aebd7952f4c0ecebb60fbeca2">atomic_fetch_and_add</a>(nnext, <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        nc-&gt;<a class="code" href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">nrem_thread</a> = <a class="code" href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> ninsert = (nc-&gt;<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a>)++;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    (nc-&gt;<a class="code" href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">nrem_thread</a>)--;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">return</span> ninsert;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div><div class="ttc" id="structNodeCache_html_a9486e11f8687f7f5797654f117a50c8c"><div class="ttname"><a href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">NodeCache::nnext_thread</a></div><div class="ttdeci">int nnext_thread</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00225">forcetree.c:225</a></div></div>
<div class="ttc" id="system_8h_html_a00eeba7aebd7952f4c0ecebb60fbeca2"><div class="ttname"><a href="system_8h.html#a00eeba7aebd7952f4c0ecebb60fbeca2">atomic_fetch_and_add</a></div><div class="ttdeci">static int atomic_fetch_and_add(int *ptr, int value)</div><div class="ttdef"><b>Definition:</b> <a href="system_8h_source.html#l00044">system.h:44</a></div></div>
<div class="ttc" id="structNodeCache_html_a34fe9100da8a71f0b571f12bb85a3c70"><div class="ttname"><a href="structNodeCache.html#a34fe9100da8a71f0b571f12bb85a3c70">NodeCache::nrem_thread</a></div><div class="ttdeci">int nrem_thread</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00226">forcetree.c:226</a></div></div>
<div class="ttc" id="forcetree_8c_html_ae9d22ac96be9a18932a00837b0a78f30"><div class="ttname"><a href="forcetree_8c.html#ae9d22ac96be9a18932a00837b0a78f30">NODECACHE_SIZE</a></div><div class="ttdeci">#define NODECACHE_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00221">forcetree.c:221</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a6710cf447fc53308c513b002cf446ebf_cgraph.svg" width="310" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a6710cf447fc53308c513b002cf446ebf_icgraph.svg" width="1986" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a95095093b87159c1b23a2cb267d9940a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95095093b87159c1b23a2cb267d9940a">&#9670;&nbsp;</a></span>get_subnode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_subnode </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structNODE.html">NODE</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>p_i</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00176">176</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00014">NODE::center</a>, and <a class="el" href="partmanager_8h_source.html#l00099">P</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00333">force_tree_create_nodes()</a>, and <a class="el" href="forcetree_8c_source.html#l00247">modify_internal_node()</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">int</span> subnode = 0;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">int</span> k;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">for</span>(k=0; k&lt;3; k++)</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        subnode |= (<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[k] &gt; node-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[k]) &lt;&lt; k;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">return</span> subnode;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div><div class="ttc" id="partmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00099">partmanager.h:99</a></div></div>
<div class="ttc" id="structNODE_html_a3460a1b4f9607fe15e6adc40a737d947"><div class="ttname"><a href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">NODE::center</a></div><div class="ttdeci">MyFloat center[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00014">forcetree.h:14</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a95095093b87159c1b23a2cb267d9940a_icgraph.svg" width="1984" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a068d7c90773680cb8c9b0684d584420d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a068d7c90773680cb8c9b0684d584420d">&#9670;&nbsp;</a></span>init_internal_node()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void init_internal_node </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structNODE.html">NODE</a> *&#160;</td>
          <td class="paramname"><em>nfreep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structNODE.html">NODE</a> *&#160;</td>
          <td class="paramname"><em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>subnode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00200">200</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00014">NODE::center</a>, <a class="el" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a>, <a class="el" href="forcetree_8h_source.html#l00018">NODE::InternalTopLevel</a>, <a class="el" href="forcetree_8h_source.html#l00013">NODE::len</a>, <a class="el" href="forcetree_8h_source.html#l00025">NODE::suns</a>, <a class="el" href="forcetree_8h_source.html#l00019">NODE::TopLevel</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00247">modify_internal_node()</a>.</p>
<div class="fragment"><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;{</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordtype">int</span> j;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keyword">const</span> <a class="code" href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a> lenhalf = 0.25 * parent-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a> = 0.5 * parent-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">TopLevel</a> = 0;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    nfreep-&gt;<a class="code" href="structNODE.html#a721d8801f7caf356aaab78a822a56640">f</a>.<a class="code" href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">InternalTopLevel</a> = 0;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">/* Detect which quadrant we are in by testing the bits of subnode:</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">         * if (subnode &amp; [1,2,4]) is true we add lenhalf, otherwise subtract lenhalf*/</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> sign = (subnode &amp; (1 &lt;&lt; j)) ? 1 : -1;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[j] = parent-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[j] + sign*lenhalf;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; 8; j++)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[j] = -1;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;}</div><div class="ttc" id="structNODE_html_a721d8801f7caf356aaab78a822a56640"><div class="ttname"><a href="structNODE.html#a721d8801f7caf356aaab78a822a56640">NODE::f</a></div><div class="ttdeci">struct NODE::@10 f</div></div>
<div class="ttc" id="structNODE_html_aa3b4bfc6b6c8c99d88860a5262679487"><div class="ttname"><a href="structNODE.html#aa3b4bfc6b6c8c99d88860a5262679487">NODE::TopLevel</a></div><div class="ttdeci">unsigned int TopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00019">forcetree.h:19</a></div></div>
<div class="ttc" id="structNODE_html_ac63501e2f4f5076dfe3534268e89bc39"><div class="ttname"><a href="structNODE.html#ac63501e2f4f5076dfe3534268e89bc39">NODE::InternalTopLevel</a></div><div class="ttdeci">unsigned int InternalTopLevel</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00018">forcetree.h:18</a></div></div>
<div class="ttc" id="structNODE_html_ae6d6383dc0bc3e1660bbe700b77a85ab"><div class="ttname"><a href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">NODE::len</a></div><div class="ttdeci">MyFloat len</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00013">forcetree.h:13</a></div></div>
<div class="ttc" id="structNODE_html_a3460a1b4f9607fe15e6adc40a737d947"><div class="ttname"><a href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">NODE::center</a></div><div class="ttdeci">MyFloat center[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00014">forcetree.h:14</a></div></div>
<div class="ttc" id="types_8h_html_af1ada7381a1118c6d51bdbb0b5e72811"><div class="ttname"><a href="types_8h.html#af1ada7381a1118c6d51bdbb0b5e72811">MyFloat</a></div><div class="ttdeci">LOW_PRECISION MyFloat</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00022">types.h:22</a></div></div>
<div class="ttc" id="structNODE_html_a2a31ed85a69cd67dce1861bd327ac6e9"><div class="ttname"><a href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">NODE::suns</a></div><div class="ttdeci">int suns[8]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00025">forcetree.h:25</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a068d7c90773680cb8c9b0684d584420d_icgraph.svg" width="2011" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab3ee27767a982ea77a18f5f4983e4344"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3ee27767a982ea77a18f5f4983e4344">&#9670;&nbsp;</a></span>inside_node()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int inside_node </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structNODE.html">NODE</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>p_i</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00186">186</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00014">NODE::center</a>, <a class="el" href="forcetree_8h_source.html#l00013">NODE::len</a>, and <a class="el" href="partmanager_8h_source.html#l00099">P</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00333">force_tree_create_nodes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;{</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">int</span> k;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">for</span>(k=0; k&lt;3; k++) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordtype">double</span> pdiff = 2*(<a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_i].Pos[k] - node-&gt;<a class="code" href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">center</a>[k]);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        pdiff = pdiff &gt; 0 ? pdiff : -1*pdiff;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">if</span>(pdiff &gt; node-&gt;<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a>)</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}</div><div class="ttc" id="partmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00099">partmanager.h:99</a></div></div>
<div class="ttc" id="structNODE_html_ae6d6383dc0bc3e1660bbe700b77a85ab"><div class="ttname"><a href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">NODE::len</a></div><div class="ttdeci">MyFloat len</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00013">forcetree.h:13</a></div></div>
<div class="ttc" id="structNODE_html_a3460a1b4f9607fe15e6adc40a737d947"><div class="ttname"><a href="structNODE.html#a3460a1b4f9607fe15e6adc40a737d947">NODE::center</a></div><div class="ttdeci">MyFloat center[3]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00014">forcetree.h:14</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_ab3ee27767a982ea77a18f5f4983e4344_icgraph.svg" width="1786" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7206eeadd2231b432e8c0932fd23b1e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7206eeadd2231b432e8c0932fd23b1e5">&#9670;&nbsp;</a></span>modify_internal_node()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int modify_internal_node </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>subnode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>p_child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>p_toplace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structTreeBuilder.html">TreeBuilder</a>&#160;</td>
          <td class="paramname"><em>tb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nnext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structNodeCache.html">NodeCache</a> *&#160;</td>
          <td class="paramname"><em>nc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>minlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>closepairs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00247">247</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">References <a class="el" href="forcetree_8h_source.html#l00016">NODE::father</a>, <a class="el" href="forcetree_8c_source.html#l00047">Father</a>, <a class="el" href="forcetree_8c_source.html#l00590">force_get_next_node()</a>, <a class="el" href="forcetree_8c_source.html#l00607">force_set_next_node()</a>, <a class="el" href="forcetree_8c_source.html#l00231">get_freenode()</a>, <a class="el" href="forcetree_8c_source.html#l00176">get_subnode()</a>, <a class="el" href="forcetree_8c_source.html#l00200">init_internal_node()</a>, <a class="el" href="forcetree_8h_source.html#l00050">TreeBuilder::lastnode</a>, <a class="el" href="forcetree_8h_source.html#l00013">NODE::len</a>, <a class="el" href="forcetree_8c_source.html#l00225">NodeCache::nnext_thread</a>, <a class="el" href="forcetree_8h_source.html#l00053">TreeBuilder::Nodes</a>, <a class="el" href="partmanager_8h_source.html#l00099">P</a>, <a class="el" href="forcetree_8h_source.html#l00025">NODE::suns</a>, and <a class="el" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00333">force_tree_create_nodes()</a>.</p>
<div class="fragment"><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;{</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordtype">int</span> ninsert;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordtype">int</span> child_subnode, new_subnode;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> too_small = tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[parent].<a class="code" href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">len</a> &lt; minlen;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">/* Just insert the particle if we have an empty spot.</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">     * If the node is already too small, do not split it,</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">     * but instead prepend the particle to a linked list.*/</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span>(p_child == -1 || too_small) {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        ninsert = parent;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        child_subnode = subnode;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        new_subnode = subnode;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">/*We have two particles here, so create a new child node to store them both.*/</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">/* if we are here the node must be large enough, thus contain exactly one child. */</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a>(p_child, tb) != -1) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            abort();</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">/* The parent is already a leaf, need to split */</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="comment">/* Get memory for an extra node from our cache.*/</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        ninsert = <a class="code" href="forcetree_8c.html#a6710cf447fc53308c513b002cf446ebf">get_freenode</a>(nnext, nc);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="comment">/*If we already have too many nodes, exit loop.*/</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">if</span>(nc-&gt;<a class="code" href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">nnext_thread</a> &gt;= tb.<a class="code" href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">lastnode</a>)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *nfreep = &amp;tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[ninsert];</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *nprnt = &amp;tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[parent];</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="comment">/* We create a new leaf node at the end of the array, and</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">         * use it to replace the particle in the parent&#39;s subnode.*/</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <a class="code" href="forcetree_8c.html#a068d7c90773680cb8c9b0684d584420d">init_internal_node</a>(nfreep, nprnt, subnode);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="comment">/*Set father of new node*/</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">father</a> = parent;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">/* The new leaf will replace p_child in the parent (done before return)</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">         * Re-attach that particle to the new leaf.*/</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        child_subnode = <a class="code" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a>(nfreep, p_child);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        new_subnode = <a class="code" href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a>(nfreep, p_toplace);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <a class="code" href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>[p_child] = ninsert;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        nfreep-&gt;<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[child_subnode] = p_child;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">/* If these target slot is empty or if the new node is too small.</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">     * Attach the new particle to the new slot. */</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">if</span>(too_small) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        (*closepairs)++;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_child].SufferFromCoupling = 1;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <a class="code" href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>[p_toplace].SufferFromCoupling = 1;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">        message(1,&quot;Close particles: %d @ [%g, %g, %g] and %d @ [%g, %g, %g]. &quot;</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">                &quot;Attached to node %d, subnode %d, at [%g, %g, %g] (len %g).\n&quot;,</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">                p_toplace, P[p_toplace].Pos[0], P[p_toplace].Pos[1], P[p_toplace].Pos[2],</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">                p_child, P[p_child].Pos[0], P[p_child].Pos[1], P[p_child].Pos[2],</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">                ninsert, child_subnode, Nodes[ninsert].center[0], Nodes[ninsert].center[1], Nodes[ninsert].center[2], Nodes[ninsert].len);</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">if</span>(p_child &lt; 0 || new_subnode != child_subnode || too_small) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <a class="code" href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>[p_toplace] = ninsert;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">/*If the node is too small we prepend the particle to a short linked list.*/</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <a class="code" href="forcetree_8c.html#a8571da12c389bfcf10555865a0e3882d">force_set_next_node</a>(p_toplace, too_small ? p_child : -1, tb);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[ninsert].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[new_subnode] = p_toplace;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="comment">/* Otherwise recurse and create a new node*/</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        ret = <a class="code" href="forcetree_8c.html#a7206eeadd2231b432e8c0932fd23b1e5">modify_internal_node</a>(ninsert, child_subnode, p_child, p_toplace, tb, nnext, nc, minlen, closepairs);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (ninsert != parent) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="comment">/* A new node is creatd. Added to the parent: this goes last</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">         * so that we don&#39;t access the child before it is constructed.*/</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="preprocessor">        #pragma omp atomic write</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        tb.<a class="code" href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">Nodes</a>[parent].<a class="code" href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">u</a>.<a class="code" href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">suns</a>[subnode] = ninsert;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div><div class="ttc" id="partmanager_8h_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="partmanager_8h.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="partmanager_8h_source.html#l00099">partmanager.h:99</a></div></div>
<div class="ttc" id="structNODE_html"><div class="ttname"><a href="structNODE.html">NODE</a></div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00011">forcetree.h:11</a></div></div>
<div class="ttc" id="forcetree_8c_html_ae1adfde6b271afd077130a64e6b85766"><div class="ttname"><a href="forcetree_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a></div><div class="ttdeci">int * Father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00047">forcetree.c:47</a></div></div>
<div class="ttc" id="structNodeCache_html_a9486e11f8687f7f5797654f117a50c8c"><div class="ttname"><a href="structNodeCache.html#a9486e11f8687f7f5797654f117a50c8c">NodeCache::nnext_thread</a></div><div class="ttdeci">int nnext_thread</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00225">forcetree.c:225</a></div></div>
<div class="ttc" id="forcetree_8c_html_a8571da12c389bfcf10555865a0e3882d"><div class="ttname"><a href="forcetree_8c.html#a8571da12c389bfcf10555865a0e3882d">force_set_next_node</a></div><div class="ttdeci">int force_set_next_node(int no, int next, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00607">forcetree.c:607</a></div></div>
<div class="ttc" id="structNODE_html_ae6d6383dc0bc3e1660bbe700b77a85ab"><div class="ttname"><a href="structNODE.html#ae6d6383dc0bc3e1660bbe700b77a85ab">NODE::len</a></div><div class="ttdeci">MyFloat len</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00013">forcetree.h:13</a></div></div>
<div class="ttc" id="structNODE_html_a9a1b7edbe811165e40220f63a38f2d16"><div class="ttname"><a href="structNODE.html#a9a1b7edbe811165e40220f63a38f2d16">NODE::father</a></div><div class="ttdeci">int father</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00016">forcetree.h:16</a></div></div>
<div class="ttc" id="forcetree_8c_html_a7206eeadd2231b432e8c0932fd23b1e5"><div class="ttname"><a href="forcetree_8c.html#a7206eeadd2231b432e8c0932fd23b1e5">modify_internal_node</a></div><div class="ttdeci">int modify_internal_node(int parent, int subnode, int p_child, int p_toplace, const struct TreeBuilder tb, int *nnext, struct NodeCache *nc, double minlen, int *closepairs)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00247">forcetree.c:247</a></div></div>
<div class="ttc" id="structNODE_html_a2a31ed85a69cd67dce1861bd327ac6e9"><div class="ttname"><a href="structNODE.html#a2a31ed85a69cd67dce1861bd327ac6e9">NODE::suns</a></div><div class="ttdeci">int suns[8]</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00025">forcetree.h:25</a></div></div>
<div class="ttc" id="forcetree_8c_html_a96d9883368c2630c024e1196e849f07c"><div class="ttname"><a href="forcetree_8c.html#a96d9883368c2630c024e1196e849f07c">force_get_next_node</a></div><div class="ttdeci">int force_get_next_node(int no, const struct TreeBuilder tb)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00590">forcetree.c:590</a></div></div>
<div class="ttc" id="forcetree_8c_html_a068d7c90773680cb8c9b0684d584420d"><div class="ttname"><a href="forcetree_8c.html#a068d7c90773680cb8c9b0684d584420d">init_internal_node</a></div><div class="ttdeci">static void init_internal_node(struct NODE *nfreep, struct NODE *parent, int subnode)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00200">forcetree.c:200</a></div></div>
<div class="ttc" id="structNODE_html_ac0a7e3bc6d29da84c41010b1336fe9ef"><div class="ttname"><a href="structNODE.html#ac0a7e3bc6d29da84c41010b1336fe9ef">NODE::u</a></div><div class="ttdeci">union NODE::@11 u</div></div>
<div class="ttc" id="structTreeBuilder_html_a3ab6259028cdd8013165ce13b0a28e4e"><div class="ttname"><a href="structTreeBuilder.html#a3ab6259028cdd8013165ce13b0a28e4e">TreeBuilder::lastnode</a></div><div class="ttdeci">int lastnode</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00050">forcetree.h:50</a></div></div>
<div class="ttc" id="forcetree_8c_html_a95095093b87159c1b23a2cb267d9940a"><div class="ttname"><a href="forcetree_8c.html#a95095093b87159c1b23a2cb267d9940a">get_subnode</a></div><div class="ttdeci">int get_subnode(const struct NODE *node, const int p_i)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00176">forcetree.c:176</a></div></div>
<div class="ttc" id="structTreeBuilder_html_a83a6e131b8f124c7f6c8f242893016ce"><div class="ttname"><a href="structTreeBuilder.html#a83a6e131b8f124c7f6c8f242893016ce">TreeBuilder::Nodes</a></div><div class="ttdeci">struct NODE * Nodes</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8h_source.html#l00053">forcetree.h:53</a></div></div>
<div class="ttc" id="forcetree_8c_html_a6710cf447fc53308c513b002cf446ebf"><div class="ttname"><a href="forcetree_8c.html#a6710cf447fc53308c513b002cf446ebf">get_freenode</a></div><div class="ttdeci">int get_freenode(int *nnext, struct NodeCache *nc)</div><div class="ttdef"><b>Definition:</b> <a href="forcetree_8c_source.html#l00231">forcetree.c:231</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a7206eeadd2231b432e8c0932fd23b1e5_cgraph.svg" width="548" height="240"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="forcetree_8c_a7206eeadd2231b432e8c0932fd23b1e5_icgraph.svg" width="1840" height="342"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ae1adfde6b271afd077130a64e6b85766"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1adfde6b271afd077130a64e6b85766">&#9670;&nbsp;</a></span>Father</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* Father</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>gives parent node in tree (nodes array) </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00047">47</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00627">force_get_prev_node()</a>, <a class="el" href="forcetree_8c_source.html#l00079">force_tree_eh_slots_fork()</a>, <a class="el" href="forcetree_8c_source.html#l01115">force_tree_free()</a>, <a class="el" href="forcetree_8c_source.html#l01086">force_treeallocate()</a>, <a class="el" href="forcetree_8c_source.html#l00970">force_update_hmax()</a>, <a class="el" href="forcetree_8c_source.html#l00247">modify_internal_node()</a>, and <a class="el" href="init_8c_source.html#l00181">setup_smoothinglengths()</a>.</p>

</div>
</div>
<a id="aca70a1751175167a36c1c6775a338bee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca70a1751175167a36c1c6775a338bee">&#9670;&nbsp;</a></span>MaxNodes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MaxNodes</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>maximum allowed number of internal nodes </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00042">42</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l01086">force_treeallocate()</a>, <a class="el" href="gravshort-tree_8c_source.html#l00110">force_treeev_shortrange()</a>, <a class="el" href="gravshort-tree-old_8c_source.html#l00143">force_treeevaluate_shortrange()</a>, <a class="el" href="forcetree_8c_source.html#l00970">force_update_hmax()</a>, <a class="el" href="treewalk_8c_source.html#l00902">ngb_treefind_threads()</a>, <a class="el" href="forcetree_8h_source.html#l00084">node_is_node()</a>, <a class="el" href="forcetree_8h_source.html#l00072">node_is_pseudo_particle()</a>, <a class="el" href="gravpm_8c_source.html#l00191">pm_mark_region_for_node()</a>, and <a class="el" href="treewalk_8c_source.html#l00483">treewalk_export_particle()</a>.</p>

</div>
</div>
<a id="ad14ab43f541f9c33cb9222ea018c1365"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad14ab43f541f9c33cb9222ea018c1365">&#9670;&nbsp;</a></span>Nextnode</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* Nextnode</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>gives next node in tree walk (nodes array) </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00046">46</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00590">force_get_next_node()</a>, <a class="el" href="forcetree_8c_source.html#l00607">force_set_next_node()</a>, <a class="el" href="forcetree_8c_source.html#l00079">force_tree_eh_slots_fork()</a>, <a class="el" href="forcetree_8c_source.html#l01115">force_tree_free()</a>, <a class="el" href="forcetree_8c_source.html#l01086">force_treeallocate()</a>, <a class="el" href="gravshort-tree_8c_source.html#l00110">force_treeev_shortrange()</a>, <a class="el" href="gravshort-tree-old_8c_source.html#l00143">force_treeevaluate_shortrange()</a>, <a class="el" href="treewalk_8c_source.html#l00902">ngb_treefind_threads()</a>, and <a class="el" href="gravpm_8c_source.html#l00191">pm_mark_region_for_node()</a>.</p>

</div>
</div>
<a id="ac46f89ba3715dfa877c2e1b8822da657"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac46f89ba3715dfa877c2e1b8822da657">&#9670;&nbsp;</a></span>Nodes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structNODE.html">NODE</a> * Nodes</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>this is a pointer used to access the nodes which is shifted such that Nodes[RootNode] gives the first allocated node </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00038">38</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="gravpm_8c_source.html#l00108">_prepare()</a>, <a class="el" href="gravpm_8c_source.html#l00253">convert_node_to_region()</a>, <a class="el" href="treewalk_8c_source.html#l00859">cull_node()</a>, <a class="el" href="gravshort-tree_8c_source.html#l00110">force_treeev_shortrange()</a>, <a class="el" href="gravshort-tree-old_8c_source.html#l00143">force_treeevaluate_shortrange()</a>, <a class="el" href="treewalk_8c_source.html#l00902">ngb_treefind_threads()</a>, <a class="el" href="gravpm_8c_source.html#l00191">pm_mark_region_for_node()</a>, <a class="el" href="init_8c_source.html#l00181">setup_smoothinglengths()</a>, and <a class="el" href="treewalk_8c_source.html#l00774">treewalk_visit_ngbiter()</a>.</p>

</div>
</div>
<a id="a0cb940c6ac9331805bcc91b437c78e9a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cb940c6ac9331805bcc91b437c78e9a">&#9670;&nbsp;</a></span>Nodes_base</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structNODE.html">NODE</a>* Nodes_base</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>points to the actual memory allocated for the nodes </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00038">38</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

</div>
</div>
<a id="a864c54aa65cc3be72a6ee67e77d4324a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a864c54aa65cc3be72a6ee67e77d4324a">&#9670;&nbsp;</a></span>RootNode</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int RootNode</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Index of the first node </p>

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00043">43</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="gravpm_8c_source.html#l00108">_prepare()</a>, <a class="el" href="treewalk_8c_source.html#l00441">ev_secondary()</a>, <a class="el" href="forcetree_8c_source.html#l01086">force_treeallocate()</a>, <a class="el" href="forcetree_8c_source.html#l00970">force_update_hmax()</a>, <a class="el" href="forcetree_8h_source.html#l00084">node_is_node()</a>, <a class="el" href="forcetree_8h_source.html#l00078">node_is_particle()</a>, <a class="el" href="forcetree_8h_source.html#l00072">node_is_pseudo_particle()</a>, <a class="el" href="treewalk_8c_source.html#l00483">treewalk_export_particle()</a>, and <a class="el" href="treewalk_8c_source.html#l00188">treewalk_init_query()</a>.</p>

</div>
</div>
<a id="a74c0df66a077bd271e68e460f36d2169"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74c0df66a077bd271e68e460f36d2169">&#9670;&nbsp;</a></span>tree_allocated_flag</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int tree_allocated_flag = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="forcetree_8c_source.html#l00049">49</a> of file <a class="el" href="forcetree_8c_source.html">forcetree.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="forcetree_8c_source.html#l00095">force_tree_allocated()</a>, <a class="el" href="forcetree_8c_source.html#l01115">force_tree_free()</a>, and <a class="el" href="forcetree_8c_source.html#l01086">force_treeallocate()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
